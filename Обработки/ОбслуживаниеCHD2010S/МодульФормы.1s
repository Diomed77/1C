#ЗагрузитьИзФайла CHD2010.txt

Перем ККМ;
Перем Расшифровка;
Перем Ширина;
Перем НомерОтдела;

//********************************************************************************

Функция ОбработкаОшибок()
                          
	Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
		ФайлР="";
		ФС.АтрибутыФайла("CHD2010S.ERR",ФайлР,,,,,);
		
		Если ФайлР>0 Тогда
			Возврат 1;    
		Иначе
			Возврат 0;
		КонецЕсли;
	Иначе
		Возврат 0;
	КонецЕсли;

КонецФункции

//********************************************************************************
Процедура Подключить()
	Если ККМ.РежимККМ=Перечисление.РежимыККМ.ФР Тогда
		РаботаСФискальнымРегистратором=0;
		Если ЗагрузитьВнешнююКомпоненту("FprnM1C.dll")<>0  Тогда
			ФискальныйРегистратор = СоздатьОбъект("AddIn.FprnM45");  // Создание объекта внешней компоненты
			Если ПустоеЗначение(ФискальныйРегистратор) = 0 Тогда
				Сообщить("ККМ Элвес Микро-Ф подключен");
			КонецЕсли;
			ФискальныйРегистратор.DeviceEnabled=1;
			Если ОбработкаОшибок() = 1 Тогда
			    Возврат;
			КонецЕсли;
			ФискальныйРегистратор.Mode = 1;
			ФискальныйРегистратор.Password = "1";
			ФискальныйРегистратор.SetMode();
			Если ОбработкаОшибок() = 1 Тогда
			    Возврат;
			КонецЕсли;
			РаботаСФискальнымРегистратором=1;
		Иначе
		 	//Сообщить("Не удалось загрузить драйвер для FP-600");	
		КонецЕсли;
	ИначеЕсли ККМ.РежимККМ=Перечисление.РежимыККМ.OffLine Тогда
		Сообщить("ВНИМАНИЕ!!! ККМ CHD-2010S не поддерживает режим Off-Line!");
	ИначеЕсли ККМ.РежимККМ=Перечисление.РежимыККМ.OnLine Тогда
		Сообщить("ВНИМАНИЕ!!! ККМ CHD-2010S не поддерживает режим On-Line!");
	КонецЕсли;
КонецПроцедуры
//********************************************************************************
Процедура Отключить()
	Если РаботаСФискальнымРегистратором=1 Тогда
        // переводим ккм в режим выбора
		ФискальныйРегистратор.Mode = 0;
		ФискальныйРегистратор.Password = "0";
		ФискальныйРегистратор.SetMode();
		Если ОбработкаОшибок() = 1 Тогда
		    Возврат;
		КонецЕсли;
		// отключаем драйвер
		ФискальныйРегистратор.DeviceEnabled=0;
		Если ОбработкаОшибок() = 0 Тогда
			// удалось отключить
			РаботаСФискальнымРегистратором=0;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

    
Процедура ПечататьЧек() Экспорт            

	Док=Расшифровка.Получить("Документ");

	Если ПустоеЗначение(Док)=1 Тогда
	    Возврат;
	КонецЕсли;

	Если Док.КоличествоСтрок()=0 Тогда
		Предупреждение("Документ пустой!");
		Возврат;
	КонецЕсли;
	
	Если ПустоеЗначение(Док.Клиент)=1 Тогда
		Предупреждение("Вы должны выбрать Клиента!");
		Возврат;
	КонецЕсли;
	                                
	Если Вопрос("Вы уверены?","Да+Нет")="Да" Тогда
	Иначе
		Возврат;
	КонецЕсли;
	
	//Закомментировано Инсталлятором МОД:Док.Записать();
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Док, );
	//Конец текста, вставленного Инсталлятором МОД

	


	Если Док.Выбран()=0 Тогда
		Предупреждение("Перед печать чека документ должен быть сохранен!");
		Возврат;
	КонецЕсли;

	Деньги=0;//Окр(Док.Итог("Сумма")+Док.Итог("НДС"),2);
	Вал=Док.Валюта;
	Вал1=Док.Валюта;
	Плат="CASH";

	СуммаДок=Окр(Док.Итог("Сумма")+Док.Итог("НДС"),2);
	
	Чек=СоздатьОбъект("Текст");

	Чек.КодоваяСтраница(0); //ДОС кодовая страница
	
	Если Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя Тогда
	Иначе                                                                 
		Вал=Док.ВалютаПлатежа;
		Вал1=Док.ВалютаПлатежа1;
		Деньги=Док.Получено;
		Деньги1=Док.Получено1;
	КонецЕсли;

	НаимСтр="";
	Адрес="";
	КодНДС="";
	Основание="";

	Если Константа.РозничныйКлиент=Док.Клиент Тогда
		Если Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя Тогда
			НаимСтр=СтрЗаменить(WinToDos(СокрЛП(Док.КлиентНаим)),"""","'");
			Адрес=СтрЗаменить(WinToDos(СокрЛП(Док.ПоДокументу.Основание)),"""","'");
			Основание="";
			КодНДС="";
		Иначе			
			НаимСтр=СтрЗаменить(WinToDos(СокрЛП(Док.КлиентНаим)),"""","'");
			Адрес=СтрЗаменить(WinToDos(СокрЛП(Док.Основание)),"""","'");
			Основание="";
			КодНДС="";
		КонецЕсли;
	Иначе
		НаимСтр=СтрЗаменить(WinToDos(СокрЛП(Док.КлиентНаим)),"""","'");
		Адрес=СтрЗаменить(WinToDos(СокрЛП(Док.клиент.Юр_Адрес)),"""","'");
		Если Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя Тогда
			Основание=СтрЗаменить(WinToDos(СокрЛП(Док.ПоДокументу.Основание)),"""","'");
		Иначе                                                               
			Основание=СтрЗаменить(WinToDos(СокрЛП(Док.Основание)),"""","'");
		КонецЕсли;
		КодНДС=WinToDos("ReЄ.Nr. "+СокрЛП(Док.Клиент.ИНН));      
	КонецЕсли;

	//Добавляем в шапку наименование клиента	
	
	Чек.ДобавитьСтроку("Comment: TEXT = """+WinToDos("-------Pirc§js-------")+"""");
    Если ПустаяСтрока(СокрЛП(НаимСтр))=0 Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Лев(НаимСтр,Ширина))+"""");
		если ПустаяСтрока(Сред(СокрЛП(НаимСтр),Ширина+1,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Сред(НаимСтр,Ширина+1,Ширина))+"""");
		КонецЕсли;
    КонецЕсли;

	Если (ПустаяСтрока(СокрЛП(КодНДС))=0) Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Лев(КодНДС,Ширина))+"""");
	КонецЕсли;	

	Если (ПустаяСтрока(Адрес)=0) Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Лев(Адрес,Ширина))+"""");

		если ПустаяСтрока(Сред(СокрЛП(Адрес),Ширина+1,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Сред(Адрес,Ширина+1,Ширина))+"""");
		КонецЕсли;

		если ПустаяСтрока(Сред(СокрЛП(Адрес),Ширина*2+2,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Сред(Адрес,Ширина*2+2,Ширина))+"""");
		КонецЕсли;
	КонецЕсли;

	Если (ПустаяСтрока(Основание)=0) Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Лев(Основание,Ширина))+"""");

		если ПустаяСтрока(Сред(СокрЛП(Адрес),Ширина+1,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Сред(Основание,Ширина+1,Ширина))+"""");
		КонецЕсли;

		если ПустаяСтрока(Сред(СокрЛП(Адрес),Ширина*2+2,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+СокрЛП(Сред(Основание,Ширина*2+2,Ширина))+"""");
		КонецЕсли;
	КонецЕсли;
	
	
	Чек.ДобавитьСтроку("Comment: TEXT = ""PPR Nr. "+СокрЛП(Док.НомерДок)+"""");
	Чек.ДобавитьСтроку("Comment: TEXT = ""Kas.:"+СокрЛП(Лев(WinToDos(Док.Автор),Ширина-5))+"""");
	Чек.ДобавитьСтроку("Comment: TEXT = ""---------------------""");

	СумЧек=0;
	НСтр=0;

	ДокСкидка=Окр(Док.Итог("Скидка")*1.18,2);
	Док.ВыбратьСтроки();
	Пока Док.ПолучитьСтроку()=1 Цикл
                            
		Если ПустоеЗначение(Док.Товар)=1 Тогда
			Предупреждение("В строке "+Док.НомерСтроки+" не выбран Товар!");
			Возврат;
		КонецЕсли;
		
		Если ПустоеЗначение(Док.СуммаСНДС)=1 Тогда
			Предупреждение("В строке "+Док.НомерСтроки+" не указана сумма Товара!");
			Возврат;
		КонецЕсли;

		НСтр=НСтр+1;
		ТоварКод=Док.Товар.Код;
		НаимТовар=СтрЗаменить(WinToDos(СокрЛП(Док.Товар.Наименование)),"""","");
		; 
		ЕдИзм=WinToDos(СокрЛП(Строка(Док.Единица)));
		КолВо=Док.Количество*Док.Коэффициент;
		                                 
		Сум=Док.СуммаСНДС;
		
//		Сум=Сум+Док.Скидка*1.18;

		СумЧек=СумЧек+Сум;
		
		Если Док.КоличествоСтрок()=НСтр Тогда //Сравниваем последнюю строку с общей суммой
			Если Окр(СумЧек,2)>СуммаДок Тогда
			    Сум=Сум-(СумЧек-СуммаДок);
			Иначе
				Сум=Сум+(СумЧек-СуммаДок);
			КонецЕсли;    
		КонецЕсли;		
		
		Чек.ДобавитьСтроку("Comment: TEXT = """+ТоварКод+"""");
		Чек.ДобавитьСтроку("Comment: TEXT = """+Лев(НаимТовар,Ширина)+"""");
		
		Чек.ДобавитьСтроку("Comment: TEXT = """+КолВо+" "+ЕдИзм+" x "+СокрЛП(Формат(Док.ЦенаСНДС,"Ч11.2"))+" "+Док.Валюта+"""");
		
		Если Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя Тогда
		Иначе
			Если Док.Скидка>0 Тогда
				Чек.ДобавитьСтроку("Comment: TEXT = "" Atl.: "+СокрЛП(Формат(Док.Скидка*1.18,"Ч11.2"))+" ("+Окр(Док.Discount,2)+"%)""");
			КонецЕсли;
		КонецЕсли;
		
		
		Если Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя Тогда
			Чек.ДобавитьСтроку("RETURN: DEPTNR = "+НомерОтдела+"; AMOUNT = "+СокрЛП(Формат(Сум,"Ч11.2")));
		Иначе
			Чек.ДобавитьСтроку("SALE: DEPTNR = "+НомерОтдела+"; AMOUNT = "+СокрЛП(Формат(Сум,"Ч11.2")));
		КонецЕсли;
		
	КонецЦикла;

	Если Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя Тогда
	Иначе
//		Если Док.Итог("Скидка")>0 Тогда
//			Чек.ДобавитьСтроку("Comment: TEXT = "" Atlaide: "+СокрЛП(Формат(ДокСкидка,"Ч11.2"))+"""");
//			Чек.ДобавитьСтроку("DISCOUNT: AMOUNT = "+СокрЛП(Формат(Док.Итог("Скидка")*1.18,"Ч11.2")));
//		КонецЕсли;
	КонецЕсли;

	Возврат_=?(Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя,1,0);

	Если Док.ПризнакНакладной=Перечисление.ПризнПрихНакл.ВозвратОтПокупателя Тогда
		Если (Док.ВидПлатежа=Перечисление.ВидыПлатежа.Карта) Тогда
			Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = 0.00; FOREIGNNR = 5");
		Иначе
			Чек.ДобавитьСтроку("PAYMENT: AMOUNT = 0.00");
		КонецЕсли;
	Иначе

		СдачаПеч=0;

		Если (Док.ВидПлатежа=Перечисление.ВидыПлатежа.Наличные) Тогда

		   Если Деньги>0 Тогда
		                                                              
		   	
				Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = "+СокрЛП(Формат(Деньги,"Ч11.2"))+
							   ?(Вал<>Константа.БазоваяВалюта,"; FOREIGNNR = "+Вал.Код,""));

				Если Вал<>Константа.БазоваяВалюта Тогда
					Чек.ДобавитьСтроку("Comment: TEXT = "" kurss par 1: "+Вал.Текущ_Курс.Получить(Док.ДатаДок)+"""");
	   				СдачаПеч=1;
				КонецЕсли;
			
		   КонецЕсли;			

		   Если Деньги1>0 Тогда
		       
				Если Вал1.Выбран()=1 Тогда
					Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = "+СокрЛП(Формат(Деньги1,"Ч11.2"))+
								   ?(Вал1<>Константа.БазоваяВалюта,"; FOREIGNNR = "+Вал1.Код,""));
				    Если Вал1<>Константа.БазоваяВалюта Тогда
						Чек.ДобавитьСтроку("Comment: TEXT = "" kurss par 1: "+Вал1.Текущ_Курс.Получить(Док.ДатаДок)+"""");
		   				СдачаПеч=1;
		   			Иначе
		   				СдачаПеч=0;
					КонецЕсли;
				КонецЕсли;			   
		   КонецЕсли;
			

		Иначе

			Если Док.ПолученоКарта>0 Тогда
				Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = "+?(Возврат_=1,"0.00",СокрЛП(Формат(Док.ПолученоКарта,"Ч11.2")))+
								   "; FOREIGNNR = 5");
				СдачаПеч=1;
			КонецЕсли;

		КонецЕсли;
		
		Если СдачаПеч=1 Тогда
			Чек.ДобавитьСтроку("CHANGE");
		КонецЕсли;
			
	КонецЕсли;
    
	ФайлН=Прав(СокрЛП(Док.НомерДок),8)+".txt";
	
	УтилПеч="CHD2010S.EXE";
	
  	ФС.УстТекКаталог(СокрЛП(ККМ.КаталогОбменаДанными));
                                                     
  	//Записать файл с чеком в текущую директорию
	//Закомментировано Инсталлятором МОД:Чек.Записать(СокрЛП(ФС.ТекКаталог())+"\"+ФайлН);
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Чек, СокрЛП(ФС.ТекКаталог())+"\"+ФайлН);
	//Конец текста, вставленного Инсталлятором МОД

	
 
	Чек=0;

	Док.ЧекПробитККМ=1;
	Док.ККМ=ККМФискальногоРегистратора;
	
	//Закомментировано Инсталлятором МОД:Док.Записать();
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Док, );
	//Конец текста, вставленного Инсталлятором МОД

	

	
	НеПроведенРезерв=0;	
	
	Рез=Док.Провести();
	
	Если (Рез=0) и (НеПроведенРезерв=0) Тогда
		Счет=СоздатьОбъект("Документ.Счет");
		
		Кл=Док.Клиент;
		Кл.ИспользоватьДату(Док.ДатаДок);
		                                    
		глСоздатьНовыйОбъект(Счет);
		Счет.АвтоРозница=1;
		Счет.Клиент=Док.Клиент;
		Счет.СрокРезервирования=999;
		Счет.Валюта=Кл.ВалютаВзаиморасчетов;
		Счет.Глубина=Кл.Глубина;
		Счет.Дилер=Кл.Дилер;
		Счет.КлиентНаим=Кл.Полное_Назв;
		Счет.СкидкаНакл=Кл.КлиентСкидка;
		
		Счет.Автор=Пользователь;

		Счет.НомерДок=СокрЛП(Константа.ПрефиксНомераСчета)+Прав("00000"+Строка(Константа.ТекущийНомерСчета+1),5);
		Константа.ТекущийНомерСчета=Константа.ТекущийНомерСчета+1;

		Счет.ДатаДок=Док.ДатаДок;
               
		// Для базовой валюты курс всегда равен 1, поэтому отображаем курс Основной валюты
		Счет.Дата_Курса=Счет.ДатаДок;
		Счет.Курс=КурсДляВалюты(Счет.Валюта,Счет.Дата_Курса);
		Счет.Фирма=Константа.ОснФирма;
		Счет.Склад=Док.Склад;
		Счет.ТипЦен=Перечисление.ТипыРасхЦен.Розничные;
		Счет.ВидСчета=Перечисление.ВидыСчета.ПродажаНал;
		
//		Счет.СрокРезервирования=Константа.ОснСрокРезервирования;
		
		Док.ВыбратьСтроки();                          
		
		Пока Док.ПолучитьСтроку()=1 Цикл
			Счет.НоваяСтрока();
			Счет.Товар=Док.Товар;
			Счет.Количество=Док.Количество;
			
			Счет.ТовКод=Док.Товар.Код;
			Счет.Цена=Док.Цена;
			Счет.Единица=Док.Единица;
			Счет.Коэффициент=Док.Коэффициент;
			Счет.Сумма=Док.Цена*Док.Количество*Док.Коэффициент;
			Счет.НДС=Док.НДС;
			Счет.РознЦена=Док.РознЦена;
			Счет.Скидка=Док.Скидка;
		КонецЦикла;                        

		Счет.ОплаченнаяСумма=100;
		
//		Счет.ПоДокументу=Док.ТекущийДокумент();
		//Закомментировано Инсталлятором МОД:Счет.Записать();
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Счет, );
	//Конец текста, вставленного Инсталлятором МОД

	


		Док.ПоСчету=Счет.ТекущийДокумент();
		//Закомментировано Инсталлятором МОД:Док.Записать();
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Док, );
	//Конец текста, вставленного Инсталлятором МОД

	


		Счет.Провести();
		                  
		Сообщить("Для документа "+Док.ТекущийДокумент()+" был создан документ "+Счет.ТекущийДокумент()+"!");
	ИначеЕсли НеПроведенРезерв=1 Тогда
		Док.ЧекПробитККМ=0;
		Док.ККМ=0;     
		//Закомментировано Инсталлятором МОД:Док.Записать();
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Док, );
	//Конец текста, вставленного Инсталлятором МОД

	

		Возврат;
		Предупреждение("Невозможно продать зарезервированный товар!");
	КонецЕсли;
	
	ПовторПечати=1;
  	Пока ПовторПечати=1 Цикл

		ПовторПечати=0; 
		
		Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
			ФС.ПереименоватьФайл("CHD2010S.ERR","CHD2010S"+ДатаЧисло(ТекущаяДата())+ДатаМесяц(ТекущаяДата())+".LOG",1);
		КонецЕсли;
		
		//Проверка на утилиту печати Чека.
		Если ФС.СуществуетФайл(УтилПеч) = 1 Тогда
		Иначе     
		   Сигнал();
		   Предупреждение("Отсутствует утилита -" + УтилПеч + "- для печати Чека. Обратитесь к системному администратору!");
		   Возврат;
		КонецЕсли;                                        
                                 
		КомандаСистемы(УтилПеч+" "+ФайлН);
		
		//Проверка на ошибку печати кассового чека
		Если ОбработкаОшибок() = 1 Тогда       
		    Если Вопрос("Произошла ошибка печати Чека. Устраните ошибку и нажмите кнопку ""Повтор""!","Повтор+Отмена")<>"Повтор" Тогда
				Сообщить("Произошла ошибка при печати чека. Чек не пробит!");
				Возврат;
			КонецЕсли;
				
			ПовторПечати=1;
		Иначе
			ФС.УдалитьФайл(ФайлН);
		КонецЕсли;
		
  	КонецЦикла;

	Док.Форма.Закрыть(0);
	
КонецПроцедуры

//******************************************************************
Процедура ВнестиСменныеДеньги()     
	

	Чек=СоздатьОбъект("Текст");
	Чек.КодоваяСтраница(0); //ДОС кодовая страница

	деньги=0;
	
	Если ВвестиЧисло(деньги,"Введите сумму",10,2)=0 Тогда
		Возврат;	    
	КонецЕсли;
	
	Если Вопрос("Вы уверены?","Да+Нет")="Да" Тогда
	Иначе
		Возврат;
	КонецЕсли;

	Если деньги>0 Тогда
		Чек.ДобавитьСтроку("RCV_ON_ACC: AMOUNT = "+СокрЛП(Формат(деньги,"Ч11.2")));
		Чек.ДобавитьСтроку("OPEN_DRAWER");
	КонецЕсли;
	
	УтилПеч="CHD2010S.EXE";
	
  	ФС.УстТекКаталог(СокрЛП(ККМ.КаталогОбменаДанными));
                                                     
  	//Записать файл с чеком в текущую директорию
	//Закомментировано Инсталлятором МОД:Чек.Записать(СокрЛП(ФС.ТекКаталог())+"\acc_in.txt");
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Чек, СокрЛП(ФС.ТекКаталог())+"\acc_in.txt");
	//Конец текста, вставленного Инсталлятором МОД

	
 
	Чек=0;
 	
	ПовторПечати=1;
  	Пока ПовторПечати=1 Цикл

		ПовторПечати=0; 
		Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
			ФС.ПереименоватьФайл("CHD2010S.ERR","CHD2010S"+ДатаЧисло(ТекущаяДата())+ДатаМесяц(ТекущаяДата())+".LOG",1);
		КонецЕсли;

		//Проверка на утилиту печати Чека.
		Если ФС.СуществуетФайл(УтилПеч) = 1 Тогда
		Иначе     
		   Сигнал();
		   Предупреждение("Отсутствует утилита -" + УтилПеч + "- для печати Чека. Обратитесь к системному администратору!");
		   Возврат;
		КонецЕсли;                                        
                                 
		КомандаСистемы(УтилПеч+" acc_in.txt");
		
		//Проверка на ошибку печати кассового чека
		Если ОбработкаОшибок() = 1 Тогда       
		    Если Вопрос("Произошла ошибка печати Чека. Устраните ошибку и нажмите кнопку ""Повтор""!","Повтор+Отмена")<>"Повтор" Тогда
				Сообщить("Произошла ошибка при печати чека. Чек не пробит!");
				Возврат;
			КонецЕсли;
				
			ПовторПечати=1;
		Иначе    
			ФС.УдалитьФайл("acc_in.txt");
		КонецЕсли;
		
  	КонецЦикла;
		
	
КонецПроцедуры

//********************************************************************************
Процедура ПечататьСуммовойЧек() Экспорт

	Док=Расшифровка.Получить("Документ");

	Если ПустоеЗначение(Док)=1 Тогда
	    Возврат;
	КонецЕсли;                       
	
	Если  ПустоеЗначение(Док.Клиент)=1 Тогда
		Предупреждение("Не выбран клиент!");
		Возврат;
	КонецЕсли;
	
	Если ПустоеЗначение(Док.Сумма)=1 Тогда
		Предупреждение("Не введена сумма!");
		Возврат;
	КонецЕсли;

	Если ПустоеЗначение(Док.Валюта)=1 Тогда
		Предупреждение("Не выбрана валюта!");
		Возврат;
	КонецЕсли;
	
	Если Вопрос("Вы уверены?","Да+Нет")="Да" Тогда
	Иначе
		Возврат;
	КонецЕсли;
	
	//Закомментировано Инсталлятором МОД:Док.Записать();
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Док, );
	//Конец текста, вставленного Инсталлятором МОД

	


	Если Док.Выбран()=0 Тогда
		Предупреждение("Перед печать чека документ должен быть сохранен!");
		Возврат;
	КонецЕсли;

	Деньги=0;//Окр(Док.Итог("Сумма")+Док.Итог("НДС"),2);
	Вал=Док.Валюта;
	Вал1=Док.Валюта;
	Плат="CASH";

	СуммаДок=Док.Сумма*Док.Валюта.Текущ_Курс.Получить(Док.ДатаДок);
	  
	Чек=СоздатьОбъект("Текст");
	Чек.КодоваяСтраница(0); //ДОС кодовая страница
	
	Если СуммаДок<0 Тогда
	Иначе                                                                 
		Вал=Док.ВалютаПлатежа;
		Вал1=Док.ВалютаПлатежа1;
		Деньги=Док.Получено;
		Деньги1=Док.Получено1;
	КонецЕсли;

	НаимСтр=СтрЗаменить(WinToDos(СокрЛП(Док.КлиентНаим)),"""","'");
	Адрес=СтрЗаменить(WinToDos(СокрЛП(Док.клиент.Юр_Адрес)),"""","'");
	Основание=СтрЗаменить(СокрЛП(Док.Основание),"""","'");
	
	Если Константа.РозничныйКлиент=Док.Клиент Тогда
		КодНДС="";
		Адрес=СтрЗаменить(WinToDos(СокрЛП(Док.Основание)),"""","'");
		Основание="";
	Иначе
		КодНДС=WinToDos("ReЄ.Nr. "+СокрЛП(Док.Клиент.ИНН));
	КонецЕсли;
      
	//Добавляем в шапку наименование клиента	
	Чек.ДобавитьСтроку("Comment: TEXT = """+WinToDos(Строка(Док.ВидОплаты))+"""");

	Чек.ДобавитьСтроку("Comment: TEXT = """+WinToDos("-------Pirc§js-------")+"""");
    Если ПустаяСтрока(СокрЛП(НаимСтр))=0 Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+Лев(СокрЛП(НаимСтр),Ширина)+"""");
		если ПустаяСтрока(Сред(СокрЛП(НаимСтр),Ширина+1,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+Сред(СокрЛП(НаимСтр),Ширина+1,Ширина)+"""");
		КонецЕсли;
    КонецЕсли;

	Если (ПустаяСтрока(СокрЛП(КодНДС))=0) Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+Лев(СокрЛП(КодНДС),Ширина)+"""");
	КонецЕсли;	

	Если (ПустаяСтрока(Адрес)=0) Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+Лев(СокрЛП(Адрес),Ширина)+"""");

		если ПустаяСтрока(Сред(СокрЛП(Адрес),Ширина+1,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+Сред(СокрЛП(Адрес),Ширина+1,Ширина)+"""");
		КонецЕсли;
	КонецЕсли;

	Чек.ДобавитьСтроку("Comment: TEXT = ""Dokum.: "+СокрЛП(Док.НомерДок)+"""");
	Чек.ДобавитьСтроку("Comment: TEXT = ""Kas.:"+Лев(WinToDos(СокрЛП(Док.Автор)),Ширина-5)+"""");
	Чек.ДобавитьСтроку("Comment: TEXT = """+WinToDos("--------------------")+"""");
                   
	если ПустаяСтрока(СокрЛП(Основание))=0 Тогда
		Чек.ДобавитьСтроку("Comment: TEXT = """+WinToDos(Лев(СокрЛП(Основание),Ширина))+"""");
		
		если ПустаяСтрока(Сред(СокрЛП(Основание),Ширина+1,Ширина))=0 Тогда
			Чек.ДобавитьСтроку("Comment: TEXT = """+WinToDos(Сред(СокрЛП(Основание),Ширина+1,Ширина))+"""");
		КонецЕсли;
		
	КонецЕсли;
	
	СумЧек=0;
	НСтр=0;

	Если СуммаДок<0 Тогда
		Чек.ДобавитьСтроку("RETURN: DEPTNR = "+НомерОтдела+"; AMOUNT = "+СокрЛП(Формат(Абс_(СуммаДок),"Ч11.2")));
	Иначе
		Чек.ДобавитьСтроку("SALE: DEPTNR = "+НомерОтдела+"; AMOUNT = "+СокрЛП(Формат(Абс_(СуммаДок),"Ч11.2")));
	КонецЕсли;
		
	Если СуммаДок<0 Тогда
		Если (Док.ВидПлатежа=Перечисление.ВидыПлатежа.Карта) Тогда
			Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = 0.00; FOREIGNNR = 5");
		Иначе
			Чек.ДобавитьСтроку("PAYMENT: AMOUNT = 0.00");
		КонецЕсли;
				
	Иначе
                                       
		СдачаПеч=0;

		Если (Док.ВидПлатежа=Перечисление.ВидыПлатежа.Наличные) Тогда

		   Если Деньги>0 Тогда
		       
				Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = "+СокрЛП(Формат(Деньги,"Ч11.2"))+
							   ?(Вал<>Константа.БазоваяВалюта,"; FOREIGNNR = "+Вал.Код,""));

				Если Вал<>Константа.БазоваяВалюта Тогда
					Чек.ДобавитьСтроку("Comment: TEXT = "" kurss par 1: "+Вал.Текущ_Курс.Получить(Док.ДатаДок)+"""");
	   				СдачаПеч=1;
				КонецЕсли;
			
		   КонецЕсли;			

		   Если Деньги1>0 Тогда
		       
				Если Вал1.Выбран()=1 Тогда
					Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = "+СокрЛП(Формат(Деньги1,"Ч11.2"))+
								   ?(Вал1<>Константа.БазоваяВалюта,"; FOREIGNNR = "+Вал1.Код,""));
				    Если Вал1<>Константа.БазоваяВалюта Тогда
						Чек.ДобавитьСтроку("Comment: TEXT = "" kurss par 1: "+Вал1.Текущ_Курс.Получить(Док.ДатаДок)+"""");
		   				СдачаПеч=1;
		   			Иначе
		   				СдачаПеч=0;
					КонецЕсли;
				КонецЕсли;			   
		   КонецЕсли;
		Иначе
			Если Док.ПолученоКарта>0 Тогда
				Чек.ДобавитьСтроку("PAYMENT: MEDIA = CASH; AMOUNT = "+СокрЛП(Формат(Док.ПолученоКарта,"Ч11.2"))+
							   "; FOREIGNNR = 5");
				СдачаПеч=1;
			КонецЕсли;
		КонецЕсли;
		
		Если СдачаПеч=1 Тогда
			Чек.ДобавитьСтроку("CHANGE");
		КонецЕсли;
			
	КонецЕсли;
    
	ФайлН=Прав(СокрЛП(Док.НомерДок),8)+".txt";
	
	УтилПеч="CHD2010S.EXE";
	
  	ФС.УстТекКаталог(СокрЛП(ККМ.КаталогОбменаДанными));
                                                     
  	//Записать файл с чеком в текущую директорию
	//Закомментировано Инсталлятором МОД:Чек.Записать(СокрЛП(ФС.ТекКаталог())+"\"+ФайлН);
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Чек, СокрЛП(ФС.ТекКаталог())+"\"+ФайлН);
	//Конец текста, вставленного Инсталлятором МОД

	
 
	Чек=0;
 	
	ПовторПечати=1;
  	Пока ПовторПечати=1 Цикл

		ПовторПечати=0; 
		
		Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
			ФС.ПереименоватьФайл("CHD2010S.ERR","CHD2010S"+ДатаЧисло(ТекущаяДата())+ДатаМесяц(ТекущаяДата())+".LOG",1);
		КонецЕсли;
		
		//Проверка на утилиту печати Чека.
		Если ФС.СуществуетФайл(УтилПеч) = 1 Тогда
		Иначе     
		   Сигнал();
		   Предупреждение("Отсутствует утилита -" + УтилПеч + "- для печати Чека. Обратитесь к системному администратору!");
		   Возврат;
		КонецЕсли;                                        
                                 
		КомандаСистемы(УтилПеч+" "+ФайлН);
		
		//Проверка на ошибку печати кассового чека
		Если ОбработкаОшибок() = 1 Тогда       
		    Если Вопрос("Произошла ошибка печати Чека. Устраните ошибку и нажмите кнопку ""Повтор""!","Повтор+Отмена")<>"Повтор" Тогда
				Сообщить("Произошла ошибка при печати чека. Чек не пробит!");
				Возврат;
			КонецЕсли;
				
			ПовторПечати=1;
		Иначе
			ФС.УдалитьФайл(ФайлН);
		КонецЕсли;
		
  	КонецЦикла;

	Док.ЧекПробитККМ=1;
	Док.ККМ=ККМФискальногоРегистратора;
	
	//Закомментировано Инсталлятором МОД:Док.Записать();
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Док, );
	//Конец текста, вставленного Инсталлятором МОД

	

	Док.Провести();
	
	Док.Форма.Закрыть(0);
	
КонецПроцедуры

//******************************************************************
Процедура ВыбратьДеньги()     
	

	Чек=СоздатьОбъект("Текст");
	Чек.КодоваяСтраница(0); //ДОС кодовая страница

	деньги=0;
	
	Если ВвестиЧисло(деньги,"Введите сумму",10,2)=0 Тогда
		Возврат;
	КонецЕсли;           
	
	Если Вопрос("Вы уверены?","Да+Нет")="Да" Тогда
	Иначе
		Возврат;
	КонецЕсли;
	
	Если деньги>0 Тогда
		Чек.ДобавитьСтроку("PAID_OUT: AMOUNT = "+СокрЛП(Формат(деньги,"Ч11.2")));
		Чек.ДобавитьСтроку("OPEN_DRAWER");
	КонецЕсли;
	
	УтилПеч="CHD2010S.EXE";
	
  	ФС.УстТекКаталог(СокрЛП(ККМ.КаталогОбменаДанными));
                                                     
  	//Записать файл с чеком в текущую директорию
	//Закомментировано Инсталлятором МОД:Чек.Записать(СокрЛП(ФС.ТекКаталог())+"\acc_out.txt");
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Чек, СокрЛП(ФС.ТекКаталог())+"\acc_out.txt");
	//Конец текста, вставленного Инсталлятором МОД

	
 
	Чек=0;
 	
	ПовторПечати=1;
  	Пока ПовторПечати=1 Цикл

		ПовторПечати=0; 
		Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
			ФС.ПереименоватьФайл("CHD2010S.ERR","CHD2010S"+ДатаЧисло(ТекущаяДата())+ДатаМесяц(ТекущаяДата())+".LOG",1);
		КонецЕсли;

		//Проверка на утилиту печати Чека.
		Если ФС.СуществуетФайл(УтилПеч) = 1 Тогда
		Иначе     
		   Сигнал();
		   Предупреждение("Отсутствует утилита -" + УтилПеч + "- для печати Чека. Обратитесь к системному администратору!");
		   Возврат;
		КонецЕсли;                                        
                                 
		КомандаСистемы(УтилПеч+" acc_out.txt");
		
		//Проверка на ошибку печати кассового чека
		Если ОбработкаОшибок() = 1 Тогда       
			
		    Если Вопрос("Произошла ошибка. Устраните ошибку и нажмите кнопку ""Повтор""!","Повтор+Отмена")<>"Повтор" Тогда
				Сообщить("Произошла ошибка. Внесение сменных денег не произошло!");
				Возврат;
			КонецЕсли;
				
			ПовторПечати=1;
		Иначе    
			ФС.УдалитьФайл("acc_out.txt");
		КонецЕсли;
		
  	КонецЦикла;
		
	
КонецПроцедуры

//******************************************************************
Процедура Xотчет()     
	
                               
	Если Вопрос("Сейчас будет произведена печать X-отчета. Вы уверены, что хотите это сделать?","Да+Нет")="Да" Тогда
	Иначе
		Возврат;
	КонецЕсли;

	
	Чек=СоздатьОбъект("Текст");
	Чек.КодоваяСтраница(0); //ДОС кодовая страница

	Чек.ДобавитьСтроку("REPORT: TYPE = X");
	
	УтилПеч="CHD2010S.EXE";
	
  	ФС.УстТекКаталог(СокрЛП(ККМ.КаталогОбменаДанными));
                                                     
  	//Записать файл с чеком в текущую директорию
	//Закомментировано Инсталлятором МОД:Чек.Записать(СокрЛП(ФС.ТекКаталог())+"\report.txt");
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Чек, СокрЛП(ФС.ТекКаталог())+"\report.txt");
	//Конец текста, вставленного Инсталлятором МОД

	
 
	Чек=0;
 	
	ПовторПечати=1;
  	Пока ПовторПечати=1 Цикл

		ПовторПечати=0; 
		Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
			ФС.ПереименоватьФайл("CHD2010S.ERR","CHD2010S"+ДатаЧисло(ТекущаяДата())+ДатаМесяц(ТекущаяДата())+".LOG",1);
		КонецЕсли;

		//Проверка на утилиту печати Чека.
		Если ФС.СуществуетФайл(УтилПеч) = 1 Тогда
		Иначе     
		   Сигнал();
		   Предупреждение("Отсутствует утилита -" + УтилПеч + "- для печати Чека. Обратитесь к системному администратору!");
		   Возврат;
		КонецЕсли;                                        
                                 
		КомандаСистемы(УтилПеч+" report.txt");
		
		//Проверка на ошибку печати кассового чека
		Если ОбработкаОшибок() = 1 Тогда       
		    Если Вопрос("Произошла ошибка печати Чека. Устраните ошибку и нажмите кнопку ""Повтор""!","Повтор+Отмена")<>"Повтор" Тогда
				Сообщить("Произошла ошибка при печати чека. Чек не пробит!");
				Возврат;
			КонецЕсли;
				
			ПовторПечати=1;
		Иначе    
			ФС.УдалитьФайл("report.txt");
		КонецЕсли;
		      
		
  	КонецЦикла;

  	Сообщить("ККМ CHD-2010S отработала печать X-отчета");
	
КонецПроцедуры


//********************************************************************************
Процедура ЗагрузкаВалют()     
	

	Чек=СоздатьОбъект("Текст");
	Чек.КодоваяСтраница(0); //ДОС кодовая страница

	вал=СоздатьОбъект("Справочник.Валюты");
	вал.НайтиПоКоду(1);   
	Если Вал.Выбран()=1 Тогда
		Чек.ДобавитьСтроку("PROGRAM: FOREIGNNR = "+Вал.Код+"; RATE = "+СокрЛП(Формат(1/Вал.Текущ_Курс.Получить(ТекущаяДата()),"Ч7.4"))+"; NAME = """+СокрЛП(Вал.Сокр_Назв)+"""");
	КонецЕсли;
	
	вал.НайтиПоКоду(2);
	Если Вал.Выбран()=1 Тогда
		Чек.ДобавитьСтроку("PROGRAM: FOREIGNNR = "+Вал.Код+"; RATE = "+СокрЛП(Формат(1/Вал.Текущ_Курс.Получить(ТекущаяДата()),"Ч7.4"))+"; NAME = """+СокрЛП(Вал.Сокр_Назв)+"""");
	КонецЕсли;

	Чек.ДобавитьСтроку("PROGRAM: FOREIGNNR = 5; RATE = 1.0000; NAME = ""KARTE""");
	
//	Чек.ДобавитьСтроку("PROGRAM: FOREIGNNR = 3; RATE = 0.0001; NAME = "" """);
//	Чек.ДобавитьСтроку("PROGRAM: FOREIGNNR = 4; RATE = 0.0001; NAME = "" """);
//	Чек.ДобавитьСтроку("PROGRAM: FOREIGNNR = 5; RATE = 0.0001; NAME = "" """);

	УтилПеч="CHD2010S.EXE";
	
  	ФС.УстТекКаталог(СокрЛП(ККМ.КаталогОбменаДанными));
                                                     
  	//Записать файл с чеком в текущую директорию
	//Закомментировано Инсталлятором МОД:Чек.Записать(СокрЛП(ФС.ТекКаталог())+"\curr.txt");
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Чек, СокрЛП(ФС.ТекКаталог())+"\curr.txt");
	//Конец текста, вставленного Инсталлятором МОД

	
 
	Чек=0;
 	
	ПовторПечати=1;
  	Пока ПовторПечати=1 Цикл

		ПовторПечати=0; 
		Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
			ФС.ПереименоватьФайл("CHD2010S.ERR","CHD2010S"+ДатаЧисло(ТекущаяДата())+ДатаМесяц(ТекущаяДата())+".LOG",1);
		КонецЕсли;

		//Проверка на утилиту печати Чека.
		Если ФС.СуществуетФайл(УтилПеч) = 1 Тогда
		Иначе     
		   Сигнал();
		   Предупреждение("Отсутствует утилита -" + УтилПеч + "- для печати Чека. Обратитесь к системному администратору!");
		   Возврат;
		КонецЕсли;                                        
                                 
		КомандаСистемы(УтилПеч+" curr.txt");
		
		//Проверка на ошибку печати кассового чека
		Если ОбработкаОшибок() = 1 Тогда       
		    Если Вопрос("Произошла ошибка печати Чека. Устраните ошибку и нажмите кнопку ""Повтор""!","Повтор+Отмена")<>"Повтор" Тогда
				Сообщить("Произошла ошибка при печати чека. Чек не пробит!");
				Возврат;
			КонецЕсли;
				
			ПовторПечати=1;
		Иначе    
			ФС.УдалитьФайл("curr.txt");
		КонецЕсли;
		
  	КонецЦикла;
		
	         
  	Сообщить("ККМ CHD-2010S Загрузка валют выполнена!");
КонецПроцедуры

//********************************************************************************

Процедура ЗакрытиеСмены()
	Если ККМ.РежимККМ=Перечисление.РежимыККМ.ФР Тогда
                                                                                       
		Если Вопрос("Сейчас будет произведена печать Z-отчета. Вы уверены, что хотите это сделать?","Да+Нет")="Да" Тогда
		Иначе
			Возврат;
		КонецЕсли;

		
		Чек=СоздатьОбъект("Текст");
		Чек.КодоваяСтраница(0); //ДОС кодовая страница
               
		Чек.ДобавитьСтроку("REPORT: TYPE = Z");		  
		
		УтилПеч="CHD2010S.EXE";
	
	  	ФС.УстТекКаталог(СокрЛП(ККМ.КаталогОбменаДанными));
                                                     
	  	//Записать файл с чеком в текущую директорию
		//Закомментировано Инсталлятором МОД:Чек.Записать(СокрЛП(ФС.ТекКаталог())+"\zreport.txt");
	//Начало текста, вставленного Инсталлятором МОД
	ОбъектЗаписать(Чек, СокрЛП(ФС.ТекКаталог())+"\zreport.txt");
	//Конец текста, вставленного Инсталлятором МОД

	
 
		Чек=0;
 	
		ПовторПечати=1;
	  	Пока ПовторПечати=1 Цикл
	
			ПовторПечати=0; 
			Если ФС.СуществуетФайл("CHD2010S.ERR") = 1 Тогда
				ФС.ПереименоватьФайл("CHD2010S.ERR","CHD2010S"+ДатаЧисло(ТекущаяДата())+ДатаМесяц(ТекущаяДата())+".LOG",1);
			КонецЕсли;
	
			//Проверка на утилиту печати Чека.
			Если ФС.СуществуетФайл(УтилПеч) = 1 Тогда
			Иначе     
			   Сигнал();
			   Предупреждение("Отсутствует утилита -" + УтилПеч + "- для печати Чека. Обратитесь к системному администратору!");
			   Возврат;
			КонецЕсли;                                        
	                                 
			КомандаСистемы(УтилПеч+" zreport.txt");
			
			//Проверка на ошибку печати кассового чека
			Если ОбработкаОшибок() = 1 Тогда       
			    Если Вопрос("Произошла ошибка печати Чека. Устраните ошибку и нажмите кнопку ""Повтор""!","Повтор+Отмена")<>"Повтор" Тогда
					Сообщить("Произошла ошибка при печати чека. Чек не пробит!");
					Возврат;
				КонецЕсли;
					
				ПовторПечати=1;
			Иначе    
				ФС.УдалитьФайл("zreport.txt");
			КонецЕсли;
			
	  	КонецЦикла;
		
		Сообщить("ККМ CHD-2010S отработала печать Z-отчета");

	ИначеЕсли ККМ.РежимККМ=Перечисление.РежимыККМ.OffLine Тогда
		Сообщить("ККМ CHD-2010S в режиме OffLine" + РазделительСТрок +
		               "не поддерживает печать Z-отчета");
	ИначеЕсли ККМ.РежимККМ=Перечисление.РежимыККМ.OnLine Тогда
		Сообщить("ККМ CHD-2010S в режиме OnLine" + РазделительСТрок +
		               "не поддерживает печать Z-отчета");
	КонецЕсли;
КонецПроцедуры
//********************************************************************************
Процедура ПриОткрытии()
	Если глФлагРасшифровки=1 Тогда
		Расшифровка=глРасшифровка;
		Если Расшифровка.РазмерСписка()<>0 Тогда
			ККМ=Расшифровка.Получить("ККМ");
			Если ПустоеЗначение(ККМ)=1 Тогда
				СтатусВозврата(0);
			    Возврат;
			КонецЕсли;
			Если НЕ(ККМ.ТипККМ=Перечисление.ТипыККМ.CHD2010S) Тогда
				Сообщить("Передан неверный тип ККМ");
				СтатусВозврата(0);
			    Возврат;
			КонецЕсли;       
			
			НомерОтдела=ККМ.НомерОтдела;
			Если ПустоеЗначение(НомерОтдела)=1 Тогда
			    НомерОтдела=1;
			КонецЕсли;
			
			Процесс=Расшифровка.Получить("Процесс");
			Если Процесс="Подключить" Тогда
				Подключить();
			ИначеЕсли Процесс="Отключить" Тогда
				Отключить();
			ИначеЕсли Процесс="ПечататьЧек" Тогда
				ПечататьЧек();      
			ИначеЕсли Процесс="ПечататьСуммовойЧек" Тогда
				ПечататьСуммовойЧек();                   
			ИначеЕсли Процесс="ЗагрузкаВалют" Тогда		
				ЗагрузкаВалют();
			ИначеЕсли Процесс="ВнестиСменныеДеньги" Тогда		
				ВнестиСменныеДеньги();				
			ИначеЕсли Процесс="ВыбратьДеньги" Тогда		
				ВыбратьДеньги();				
			ИначеЕсли Процесс="Xотчет" Тогда		
				Xотчет();				
			ИначеЕсли Процесс="ЗакрытиеСмены" Тогда
				ЗакрытиеСмены();
			Иначе
				Сообщить("Для обработки ККМ CHD-2010S передан неизвестный процесс");
			КонецЕсли;
			СтатусВозврата(0);
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

Ширина=22;
