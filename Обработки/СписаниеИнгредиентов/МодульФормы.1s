//-------------------------------
Процедура Движения()    
	Перем КолСписано;
	
	СписокСписаний=СоздатьОбъект("СписокЗначений");
	
	Если ВыбДокумент.Выбран()=0 Тогда
		Предупреждение("Выберите документ!"); 
		Возврат; 
	КонецЕсли;
	Если ВыбДокумент.Проведен()=0 Тогда
		Предупреждение("Выберите проведенный документ!"); 
		Возврат; 
	КонецЕсли;
	
	//  Создание Таблицы для выходного отчета
	Таб=СоздатьОбъект("Таблица");
	ЧислоСтрок=0;
	Таб.ВывестиСекцию("Отчет");
	Оживить(3);
	Комментарий="";
	
	Рег=СоздатьОбъект("Регистр.ОстаткиТоваров");
	Если Рег.ВыбратьДвиженияДокумента(ВыбДокумент)=1 Тогда
		Оживить(1);
		Пока Рег.ПолучитьДвижение()=1 Цикл
			ФлагУчета=?(Рег.ФлагУчета=1,"Внутренний","Внешний");
			ЗнакДвиж=?(Рег.Приход=1,"+","-");
			Если Рег.ФлагУчета=1 Тогда
				Если Рег.Приход=1 Тогда
				Иначе
				КонецЕсли;
			Иначе
				Если Рег.Приход=1 Тогда
					КолСпис=Рег.ОстатокТовара;
				Иначе
					КолСпис=Рег.ОстатокТовара*(-1);
					Оживить(1);
				КонецЕсли;
			КонецЕсли;
			
			//----------------------------------
			Позиция = 0;
			КолСписано = "";
			Если СписокСписаний.РазмерСписка() = 0 Тогда
				КолСписано = Строка(КолСпис);
				СписокСписаний.ДобавитьЗначение(Рег.Товар,КолСписано);
			Иначе
				Позиция =  СписокСписаний.НайтиЗначение(Рег.Товар);
				Если Позиция <> 0 Тогда
					СписокСписаний.ПолучитьЗначение(Позиция,КолСписано);
					Кол = Число(ВыбратьЗначение(КолСписано, 1, "~"));
					КолСписано = Строка(КолСпис + Кол);
					СписокСписаний.УстановитьЗначение(Позиция,Рег.Товар,КолСписано);
				Иначе
					КолСписано = Строка(КолСпис);
					СписокСписаний.ДобавитьЗначение(Рег.Товар,КолСписано);
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;    
		Для Счет = 1 По СписокСписаний.РазмерСписка() Цикл
			КолСписано = "";
			
			Товар = СписокСписаний.ПолучитьЗначение(Счет, КолСписано);
			Количество = Число(ВыбратьЗначение(КолСписано, 1, "~"));
			Количество=Количество*(-1);
			Если Количество<>0 Тогда
				Разм1=Товар.БазоваяЕдиницаИзмерения;
				Таб.ВывестиСекцию("СтрокаРегОст"); 
			КонецЕсли;	
		КонецЦикла;
		СписокСписаний = 0;
		//---------------------------------
	КонецЕсли;
	
	
	
	//Вызов выходного отчета в окно просмотра и редактирования.
	Таб.ТолькоПросмотр(1);
	Таб.Опции(0,0,3,0,,"Списание по марочному отчету");
	Таб.Показать("Списание по марочному отчету "+ВыбДокумент,"");
КонецПроцедуры
//-------------------------------
Процедура ПриОткрытии()
	Если глФлагРасшифровки=1 Тогда
		Если глРасшифровка.РазмерСписка()<>0 Тогда
			ВыбДокумент=глРасшифровка.Получить("ВыбДокумент");
			Движения();
			СтатусВозврата(0);
			Возврат;       
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры
//-------------------------------
ВыбВалюта=Рубли;
