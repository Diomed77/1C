Обработка "Обмен данными с мобильными устройствами"

Данная обработка предназначена для двухстороннего обмена данными с мобильными приложениями
"Агент Плюс" версии 1.5 и "Агент Плюс: Мобильная торговля", установленными на мобильных устройствах
(далее МУ). 

Обмен производится при помощи внешней компоненты "APPlus.dll", обеспечивающей передачу данных с
рабочего компьютера  на МУ и обратно. Так же обязательно должна быть установлена программа "Microsoft 
|ActiveSync", иначе компонента "APPlus.dll" не загрузится (установка ПО "Microsoft ActiveSync" обязательно 
для операционных систем Windows версий не выше XP). 
       
Поддерживается также обмен данными посредством электронной почты или через FTP-сервер (любой из этих
способов применяется при мобильном обмене данными. Эти способы обмена доступны только для приложения
"Агент Плюс" версии 1.5). Для корректной работы с почтой, необходимо, чтобы на компьютере по умолчанию 
был установлен почтовый клиент "Outlook Express" или "Outlook" (предпочтительней "Outlook Express"), для первого
запуска сеанса работы с почтой желательно подключиться к Интернет.
Помимо перечисленных способ обмена существует еще один способ - это использование специальной службы
"Агент Плюс СОД" (предоставляется бесплатно). Данный способ является наиболее предпочтительным.
Описание обмена через службу "Агент Плюс СОД" читайте ниже.

Закладка "Обмен данными"

В поле «Агент» выбирается торговый агент (пользователь МУ), с устройством которого в текущий момент 
осуществляется обмен данными.
Если МУ торгового агента подключено к компьютеру напрямую (через USB-кабель), то программа позволяет 
автоматически определить подключенного агента:  для этого предназначена кнопка "=". 

В выпадающем списке «Способ обмена» необходимо выбрать, каким способом производится в текущий момент
обмен данными между компьютером и МУ. Обмен данными может происходить через:  
	1. Прямое подключение. Когда МУ подключено к ЦБД напрямую (например, через USB-соединения, Bluetooth 
	или Wi-Fi). 
	2. Агент Плюс СОД. Способ обмена через службу "Агент Плюс СОД". Параметры службы задаются на форме 
	"Настройка параметров для мобильного приложения", а также в справочнике  "Агенты" для каждого агента.
	3. FTP-сервер. Обмен данными в этом случае происходит через FTP-сервер, параметры которого задаются на
	форме "Настройка параметров для мобильного приложения"  и для каждого агента в справочнике "Агенты".  
	Данный способ обмена доступен только для обмена с приложением "Агент Плюс", версии 1.5.
	4. Электронная почта. Файлы выгрузки и загрузки будут передаваться через электронную почту. Параметры для
	электронной почты настраиваются для каждого агента в справочнике "Агенты" и, непосредственно, в самом МУ. 
	Для корректной работы с почтой, необходимо, чтобы на компьютере по умолчанию был установлен почтовый клиент 
	"Outlook Express" или "Outlook" (предпочтительней "Outlook Express"), для первого запуска сеанса работы с почтой
	желательно подключиться к сети Интернет. Данный способ обмена доступен только для обмена с приложением 
	"Агент Плюс", версии 1.5.           
	
По умолчанию значение реквизита "Способ обмена" берется из константы "Способ обмена", которая задана на форме
констант "Настройка параметров для мобильного приложения".

В поле "Вид выгрузки" выбирается вид выгружаемых данных. Он может принимать следующие значения:       
	1. Все данные (с расчетом истории продаж). Выгружаются из ЦБД все данные, включая расчет истории продаж 
	    товаров для каждого контрагента. 
	2. Все данные (история продаж из автовыгрузки). Выгружаются из ЦБД все данные, но история продаж товаров
	    для каждого контрагента берется из файла автовыгрузки, сформированного при выгрузке данных при варианте 
	    выгрузки "Только история продаж". Этот тип выгрузки предназначен для уменьшения времени обработки больших
	    объемов данных - в этом случае будут выгружаться не вся история продаж, а только те данные, которых не 
	    существует в файле автовыгрузки.
	3. Только история продаж.  При этом обработка запускает расчет истории продаж для каждого торгового агента и 
	    помещает результаты в промежуточные файлы. В дальнейшем при выгрузке данных в МУ эти файлы будут 
	    автоматически включены в выгрузку данных.
	4. Только запрошенные данные. Выгружаются данные, запрошенные агентом из МУ. 
	
Кнопка "Список загруженных документов", расположенная на форме, предназначена для отображения списка
загруженных документо за текущий день по указанному агенту. 

При нажатии на кнопку "Журнал обмена" формируется отчет "Журнал обмена данными с мобильными устройствами"
за текущий день по указанному агенту.      

Закладка "Настройки"  

При выборе флажка "Стартовые номера" для выгрузки в МУ подготавливается список стартовых номеров нумераторов
документов. Для ПО "Агент+ Стандарт" автонумерация документов в МУ необязательна (номера документов, созданных
в МУ, могут присваиваться в 1С: Предприятии автоматически после их загрузки в базу), но в "Агент+ Инвент" использование 
нумераторов является обязательным условием (как минимум для документов "Реализация", "Счет-Фактура" и "Кассовый 
ордер").

Выбирать этот флажок следует только при необходимости установки новых стартовых номеров нумераторов документов. 
При выбранном флажке становится доступна закладка окна "Стартовые номера", в которой указываются стартовые номера
нумераторов документов и здесь же (при необходимости) можно сменить стартовый номер у любого из нумераторов. 

Флаг "Обновлять документы" предназначен для обновления информации в документах, которые уже были раньше загружены
в центральную базу данных (ЦБД), например, с целью дозаказа или уточнения каких-либо документов на месте у клиента.

Флаг "Товары без остатков" означет, что в МУ будут также выгружены товары, по которым нет остатков по складам (по 
умолчанию выгружаются только товары с остатками на складах).

Флаг "Учитывать резервы" - при выгрузке остатков номенклатуры будут учитываться товары, числищиеся в резерве.

Флаг "Использовать zip-архивы" указывает будет ли использоваться архивирование файлов при обмене данными или нет.
При этом в МУ также должен быть выставлен или сброшен флажок в настройках обмена.

Флаг "Обновить остатки по мобильному складу" означает, что при выгрузке данных в МУ в ЦБД будет создан виртуальный 
документ инвентаризации, который будет перенесен в МУ. В результате будут обновлены текущие остатки по передвижному 
складу агента.

Флаг "Выгружать картинки товаров" указывает, будут ли выгружены файлы с картинками товаров в МУ, хранящихся в БД 
1С:Предприятия в справочнике "Номенклатура".

Флаг "Выгружать задания" означает, что в МУ будут выгружены задания для текущего агента, сформированные с помощью 
документов "Задание агента". Выгружаются задания за указанный период, по умолчанию период заполняется текущим днем.

Если выгрузка производится для приложения "Агент Плюс: Мобильная торговля", то становится доступным флажок "Очищать
справочники перед загрузкой". Если он включен, то перед загрузкой файла обмена в МУ предварительно будут очищены
основные справочники в базе МУ (контрагенты, договоры, торговые точки, номенклатура). Таким образом, в МУ всегда будут
отображаться актуальные данные. Если же флажок не включен, то данные в справочники будут дозагружаться каждый раз в
результате загрузки файла обмена.

В поле "Реализация по заявкам" выбирается то, каким способом будут загружаться заявки из МУ в ЦБД: 

Не создавать документ реализации. При загрузке заявок из МУ будут создаваться документы "Заказ покупателя" в ЦБД. 
Создавать на основании заявки (метод "Заполнить"). При загрузке заявок из МУ будут создаваться документы "Заказ покупателя",
а также на основании этих загруженных заявок будут созданы документы "Реализация товаров и услуг".
Перенос содержимого заявки в реализацию. При этом способе загрузки документы "Заказ покупателя" создаваться не будут, а 
сразу будут созданы документы "Реализация товаров и услуг"

Дополнительно:

Обработка поддерживает запуск с переданным параметром. Запуск обработки с параметрами в демонстрационной конфигурации
организован через справочник "Команды". Если в параметре указана строка "История_продаж", обработка запускает расчет
истории продаж для каждого торгового агента и помещает результаты в промежуточные файлы. 
В дальнейшем при выгрузке данных в МУ эти файлы будут автоматически включены в выгрузку данных. Если в параметре 
указана строка "Почта_Отправить", обработка запускает рассылку данных по электронной почте для всех агентов, у которых
в справочнике "Агенты" указан адрес электронной почты.
Если в параметре указана строка "ФТП_Отправить", обработка запускает рассылку данных через FTP-сервер для всех агентов,
у которых в справочнике "Агенты" указана папка FTP-сервера для обмена данными.
Если в параметре указана строка "ФТП_Принять", обработка запускает прием данных через FTP-сервер  от всех агентов, у которых
в справочнике "Агенты" указана папка FTP-сервера для обмена данными.
Если в параметре указана строка "АПС_Отправить", обработка запускает рассылку данных через службу "Агент Плюс СОД" для всех
агентов, у которых в справочнике "Агенты" указана папка для обмена данными. 
Если в параметре указана строка "АПС_Принять", обработка запускает прием данных через службу "Агент Плюс СОД" для всех агентов,
у которых в справочнике "Агенты" указана папка обмена обмена данными.
Если в параметре указана строка "АПС_Авто", обработка запускает режим автоматического приема оповещений с "Агент Плюс СОД"
("Агент Плюс СОД" может применяться в версиях "Агент Плюс", начиная с версии 1.50.07). Оповещения от "Агент Плюс СОД" поступают
в 1С:Предприятие через "обработчик внешних событий" (предопределенную процедуру "ОбработкаВнешнегоСобытия"). Активация 
механизма оповещения организуется при помощи внешней компоненты "APPlus.dll". Обмен данными с ""Агент Плюс СОД" организуется 
|через эту же обработку. Режим оповещения от "Агент Плюс СОД" включается методом АпсВключитьСервер() компоненты "APPlus.dll"
|(по умолчанию режим оповещения ОТКЛЮЧЕН!). Отключается режим оповещения методом АпсОтключитьСервер().

ВНИМАНИЕ !!!
В случае, если торговый агент, для которого выгружаются данные в МУ рабоатет как продавец при операциях "торговли с колес" 
(ТСК) (т.е. продает товар с борта машины и оформляет все документы купли-продажи), то в МУ для такого агента ВЫГРУЖАЮТСЯ 
ДВА ОСТАТКА ТОВАРА - остаток товара В ФИРМЕ и остаток товара В МАШИНЕ.

Первый остаток используется агентом для выписки счетов или оформления заявок на поставку товаров клиентам с учетом остатков
в фирме. Так же этот остаток может учитываться агентом при оформлении заявок на погрузку товара в машину.

Второй остаток используется агентом в операциях "торговли с колес", т.е. при оформлении документов продажи товарв с борта 
машины или при оформлении документов выгрузки товаров с машины на склад фирмы. 

Первый остаток выгружается в МУ в составе прайс-листа. Второй остаток выгружается в МУ только в виде документов 
"Перемещение", которые автоматически проводятся в МУ сразу после их загрузки.

Примечание: 
При прямом подключении устройства к ПК в том случае, если по какой-либо причине обаботка не может определить подключение, 
то в результате выгрузки или загрузки данных будет предложена возможность выгрузки/загрузки данных через файл на локальном 
ПК. Такой вариант удобен, например, при использовании терминального режима работы с системой 1С:Предприятия, если нужно 
передать или загрузить данные из БД 1С, но нет возможности подключиться к БД 1С напрямую с локального ПК.

