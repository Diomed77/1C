//***********************************************************
//<<Алгоритм Успеха>> (begin)
Процедура ВводНового()
	Сообщить("Документ вводится только на основании Заказа от покупателя!");
	СтатусВозврата(0);
КонецПроцедуры
//-------------------------------
Процедура ИзмДатаПоставки() //предопределенная
	СрокРезервирования = КолвоБанковскихДней(ДатаДок,ДатаПоставки);
КонецПроцедуры //ПриЗаписи
//_____________________________________________________________________________
Процедура ВводНаОсновании(ДокОснование)
	Если ДокОснование.Вид()<>"ЗаказОтПокупателя" Тогда
	    Сообщить("Документ вводится на основании Заказа от покупателя!");
		СтатусВозврата(0);
		Возврат;
	КонецЕсли;
	Если ДокОснование.Проведен()=0 Тогда
	    Сообщить("Заказ от покупателя не проведен!");
		СтатусВозврата(0);
		Возврат;
	КонецЕсли; 
	
	ДокументОснование=ДокОснование;
	
	Докум=СоздатьОбъект("Документ"); 
	Докум.ОбратныйПорядок(1);
	Докум.ВыбратьПодчиненныеДокументы(ДокОснование.ТекущийДокумент(),,ДокОснование.ТекущийДокумент()); 
	Пока Докум.ПолучитьДокумент()=1 Цикл
		Если Докум.Вид()<>"КорректировкаЗаказОтПокупателя" Тогда
			Продолжить;    
		КонецЕсли;
	    Если Докум.ПометкаУдаления()=1 Тогда
	        Продолжить;
		КонецЕсли;     
		Если Докум.Проведен()=0 Тогда
		    Продолжить;
		КонецЕсли;
		ДокОснование=Докум.ТекущийДокумент();
	КонецЦикла; 
	
	ЗаполнитьШапкуНаОсн(Контекст,ДокОснование);
	ДатаДок=РабочаяДата();
    Клиент=ДокОснование.Клиент;
	Склад=ДокОснование.Склад;
    ДатаПоставки=ДокОснование.ДатаПоставки;
	ИзмДатаПоставки();
	ДокОснование.ВыбратьСтроки();
	Пока ДокОснование.ПолучитьСтроку()=1 Цикл
	    НоваяСтрока();
		ТовКод=ДокОснование.ТовКод;
		Товар=ДокОснование.Товар;
		Количество=ДокОснование.Количество;
		Единица=ДокОснование.Единица;
		Коэффициент=ДокОснование.Коэффициент;
	КонецЦикла;
	
КонецПроцедуры  

Процедура ПриВводеСтроки()
	СтатусВозврата(0);
КонецПроцедуры
//***************************************************************
Процедура ПриОткрытии() //предопределенная
	ПриЗаписиПерепроводить(1);
КонецПроцедуры //ПриОткрытии 
//<<Алгоритм Успеха>> (end) 
//************************************************************
//Начало текста, вставленного Инсталлятором МОД
Процедура ПриЗаписи()
	//Внимание: данная процедура при обновлении Менеджера будет перезаписана заново
	//без сохранения текущего кода !!!
	//Рекомендуем собственные алгоритмы записывать в старую процедуру с префиксом стар_
	ПриИзмененииОбъекта(Контекст, ТекущийДокумент(), ДатаДок);
	Если семМожноЗаписать( Контекст ) = 0 Тогда Возврат; КонецЕсли;
КонецПроцедуры
//Конец текста, вставленного Инсталлятором МОД
