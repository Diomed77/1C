Перем спТоваров;

Процедура Подбор()
	
	
	ОткрытьПодбор("Сотрудники","ФормаСписка");
КонецПроцедуры

Процедура ОбработкаПодбора( ВыбОтдел )
	                                   
	спОтделов=СоздатьОбъект("СписокЗначений");
	ВыгрузитьТабличнуюЧасть(спОтделов,"Отдел");
	Если спОтделов.НайтиЗначение( ВыбОтдел ) > 0 Тогда 
		Предупреждение( "В документе уже есть данный отдел!" );
		Возврат;
	КонецЕсли;
	ВыбПлан = 0; 
	ВвестиЧисло( ВыбПлан, "Планируемый объем брутто прибыли", 6, 0 );
	НоваяСтрока();
	Отдел = ВыбОтдел;
	План = ВыбПлан;
	СортироватьСтроки("+Отдел");
	АктивизироватьСтроку();
КонецПроцедуры


Процедура ВводНового(ФлКопирования)
	
	Если Пользователь.РазрПланированиеПрибыли = 0 Тогда
		Предупреждение( "Недостаточно полномочий пользователя!" );
		СтатусВозврата( 0 ); Возврат;
	КонецЕсли;
	ЗаполнитьШапку(Контекст);
	
	Если ФлКопирования=1 Тогда
		Возврат;	    
	КонецЕсли;
КонецПроцедуры

Процедура ПриОткрытии()
	Если Пользователь.РазрПланированиеПрибыли = 0 Тогда
		Предупреждение( "Недостаточно полномочий пользователя!" );
		СтатусВозврата( 0 ); Возврат;
	КонецЕсли;
	ПроверкаРазрешенияРедактирования( Контекст );
	Если Проведен() = 1 Тогда Форма.ТолькоПросмотр( 1 ); КонецЕсли;
	Если Форма.ТолькоПросмотр() = 1 Тогда
		Форма.кнОК.Доступность( 0 );
		Форма.КнопкаПоУмолчанию("кнЗакрыть");
		Форма.кнПодбор.Доступность( 0 );
		Форма.кнОчистить.Доступность( 0 );
	Иначе
		Форма.КнопкаПоУмолчанию("кнОК");
	КонецЕсли; 
КонецПроцедуры

Функция ПроверкаДаты()
	промДата = Дата( ДатаГод( ДатаДок ), ДатаМесяц( ДатаДок ), 5 );
	Если ( РабочаяДата() > промДата ) и ( НазваниеНабораПрав() <> "Администратор" ) Тогда
		Возврат "Нельзя изменять документы позже 5-го числа!";
	КонецЕсли;   
КонецФункции

Процедура ПриЗаписи()
	Если семМожноЗаписать( Контекст ) = 0 Тогда Возврат; КонецЕсли;

	Результат = ПроверкаДаты();
	Если ПустоеЗначение( Результат ) = 0 Тогда
		Предупреждение( Результат );
		СтатусВозврата( 0 );
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриИзмененииПорядкаСтрок()
	Предупреждение( "В этом документе нельзя изменять порядок строк." );
	СтатусВозврата( 0 );
КонецПроцедуры

Процедура ПриВводеСтроки()
	//Предупреждение( "В этом документе новые строки вводятся только через подбор." );
	СтатусВозврата( 0 );
КонецПроцедуры
