
//Начало текста, вставленного Инсталлятором МОД
Процедура ОбработкаПроведения() Далее
//Конец текста, вставленного Инсталлятором МОД
Процедура стар_ОбработкаПроведения()


	
	СпрЗапасы = СоздатьОбъект("Справочник.Запасы");
	Если (ГрупповаяОбработка()=0) Тогда
	
		ВыбратьСтроки();    
		Пока ПолучитьСтроку()>0 Цикл
			// проверяем наличие товара в строке
			Если Товар.Выбран() = 0 Тогда 
				Сообщить(Шаблон("Не выбран товар в строке [НомерСтроки]"),"I");
				Продолжить; 
			КонецЕсли;
	
			Если МинЗапас<>МинЗапасНов Тогда
				Если ПустоеЗначение(Запас)=1 Тогда
					СпрЗапасы.ИспользоватьВладельца(Товар);
					Если СпрЗапасы.НайтиПоРеквизиту("УпрАналитика",УпрАналитика,0)=0 Тогда
						СпрЗапасы.Новый();
						СпрЗапасы.УпрАналитика = УпрАналитика;
						ОбъектЗаписать(СпрЗапасы,);
					КонецЕсли;
					Запас 	= СпрЗапасы.ТекущийЭлемент();
				КонецЕсли;
				
				СпрЗапасы.НайтиЭлемент(Запас);
				Если СпрЗапасы.ПометкаУдаления()=1 Тогда
					СпрЗапасы.СнятьПометкуУдаления();
				КонецЕсли;
				
				СпрЗапасы.МинЗапас = МинЗапасНов;
				СпрЗапасы.Записать();
			КонецЕсли;
			
			Состояние("Обработано: "+НомерСтроки+"/"+КоличествоСтрок());
		КонецЦикла;
	КонецЕсли;	
		
КонецПроцедуры
//Начало текста, вставленного Инсталлятором МОД
Процедура ОбработкаПроведения()
	//Внимание: данная процедура при обновлении Менеджера будет перезаписана заново
	//без сохранения текущего кода !!!
	//Рекомендуем собственные алгоритмы записывать в старую процедуру с префиксом стар_
	Если ПроведениеМОД(Контекст)=1 Тогда
		Возврат;
	КонецЕсли;
	стар_ОбработкаПроведения();
КонецПроцедуры

Процедура стар_ОбработкаУдаленияПроведения()
	
	СпрЗапасы = СоздатьОбъект("Справочник.Запасы");
	Если (ГрупповаяОбработка()=0) Тогда
	
		ВыбратьСтроки();    
		Пока ПолучитьСтроку()>0 Цикл

			// проверяем наличие товара в строке
			Если Товар.Выбран() = 0 Тогда 
				Сообщить(Шаблон("Не выбран товар в строке [НомерСтроки]"),"I");
				Продолжить; 
			КонецЕсли;
	
			СпрЗапасы.НайтиЭлемент(Запас);
			СпрЗапасы.МинЗапас = МинЗапас;
			СпрЗапасы.Записать();
			
			Состояние("Обработано: "+НомерСтроки+"/"+КоличествоСтрок());
		КонецЦикла;
	КонецЕсли;	
	
КонецПроцедуры

//Конец текста, вставленного Инсталлятором МОД
//Начало текста, вставленного Инсталлятором МОД
Процедура ОбработкаУдаленияПроведения()
	//Внимание: данная процедура при обновлении Менеджера будет перезаписана заново
	//без сохранения текущего кода !!!
	//Рекомендуем собственные алгоритмы записывать в старую процедуру с префиксом стар_
	Если ПроведениеПоАлгоритмуМОД=1 Тогда
		Возврат;
	КонецЕсли;
	ПриИзмененииОбъекта(Контекст, ТекущийДокумент(), ДатаДок);
	ПриОтменеПроведенияДокумента(ТекущийДокумент());	
	стар_ОбработкаУдаленияПроведения();
	
КонецПроцедуры
//Конец текста, вставленного Инсталлятором МОД

