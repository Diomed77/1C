Перем ТекстС;


Процедура Доступ()

	Форма.ЧекПечать.Видимость(?((ПустоеЗначение(ККМФискальногоРегистратора)=1) ИЛИ (Проведен()=1) ИЛИ (ЧекПробитККМ=1) ИЛИ (ВидОплаты<>Перечисление.ВидыОплаты.Возврат),0,1));
//	Форма.Касса_.Видимость(?((ПустоеЗначение(ККМФискальногоРегистратора)=1) ИЛИ (Проведен()=1) ИЛИ (ЧекПробитККМ=1),0,1));
	
	Форма.ОК.Доступность(?(Найти(нрег(НазваниеНабораПрав()),"кассир")=1,0,1));

КонецПроцедуры

Процедура семУстановитьВалюту( флКопирования )
	Если флКопирования = 0 Тогда
		Валюта = Рубли;
	КонецЕсли;
	Курс = КурсДляВалюты( Валюта, ДатаДок );
КонецПроцедуры

Процедура ВводНового( флКопирования )
	ЗаполнитьШапку(Контекст); //заполняем обязательные реквизиты в любом случае	
	семУстановитьВалюту( флКопирования );
	Если флКопирования = 1 Тогда Возврат; КонецЕсли;
	ВидОплаты=Перечисление.ВидыОплаты.Возврат;
	ВидПлатежа=Перечисление.ВидыПлатежа.Наличные;
	ВалютаПлатежа=Константа.БазоваяВалюта;
	Клиент=Константа.ЧастноеЛицо;
КонецПроцедуры     

Процедура РасчетНалогов()
	СуммаНП=Сумма*СтавкаНП/(100+СтавкаНП);
	СуммаНДС = (Сумма-СуммаНП)*ПроцентНДС(СтавкаНДС)/(100+ПроцентНДС(СтавкаНДС));
КонецПроцедуры
//_____________________________________________________________________________ 
Процедура ПриВыбореСтавки()
	РасчетНалогов();
КонецПроцедуры   
//-----------------------------------------------
Функция СуммаПрописьюРКО(Сум,ПромВал)  
	Если ПромВал <> Рубли Тогда
		Если ФС.СуществуетФайл(КаталогИБ()+ПромВал.ИмяФайлаПрописи)=1 Тогда
			Пропись(ПромВал.ИмяФайлаПрописи);
		КонецЕсли;  
	КонецЕсли;
	СтрокаСуммы=Формат(Сум,"ЧПДС");
	Пропись("");
	Возврат СтрокаСуммы;
КонецФункции
//-----------------------------------------------
Процедура ВводНаОсновании(ДокОснование)
	ДокВид=ДокОснование.Вид();
	Если 	(ДокВид="ПриходнаяНакладная") ИЛИ
 			(ДокВид="РегистрацияСчета_фактуры") ИЛИ
 			(ДокВид="ЗаказОтПокупателя") ИЛИ
 			(ДокВид="ПриходныйОрдерТБ") ИЛИ
 			(ДокВид="ПриходнаяРеализатора") Тогда
		ЗаполнитьШапкуНаОсн(Контекст,ДокОснование);
//	    УстановитьНовыйНомер( Фирма.ПрефиксНомеровДокументов+"-" );
		ДатаДок=РабочаяДата();
		Клиент=ДокОснование.Клиент;
		Основание=ДокОснование.Вид()+" № " + ДокОснование.НомерДок + " от " + ДокОснование.ДатаДок;
		ДокВид=ДокОснование.Вид();  
		ДокументОснование=ДокОснование;    
		Валюта=ДокОснование.Валюта;
		ВидПлатежа=Перечисление.ВидыПлатежа.Наличные;
		
		ВидОплаты=Перечисление.ВидыОплаты.Оплата;
		
		СтавкаНДС=Константа.ОсновнаяСтавкаНДС;  
		СтавкаНП=Константа.ОсновнойНП;
		           
		Если (ДокВид="ЗаказОтПокупателя") Тогда
			Основание=СокрЛП(ДокОснование.ФИО)+" / "+СокрЛП(ДокОснование.ФАДРЕС);
			Сумма=ДокОснование.СуммаПредоплаты;
			РасчетНалогов();
		ИначеЕсли (ДокВид="ПриходныйОрдерТБ") Тогда
			ВидОплаты=Перечисление.ВидыОплаты.Возврат;
			Основание=ДокОснование.Основание;   
			КлиентНаим=ДокОснование.КлиентНаим;
			ДокументОснование=ДокОснование.ДокументОснование;
			ПоДокументу=ПеревестиНаГосЯзык(ДокументОснование.Вид())+" Nr. " + ДокументОснование.НомерДок + " no " + ДокументОснование.ДатаДок;
			Сумма=ДокОснование.Сумма;
			РасчетНалогов();
		Иначе
			Основание=ПеревестиНаГосЯзык(ДокВид)+" Nr. " + ДокОснование.НомерДок + " no " + ДокОснование.ДатаДок;
			Сумма=ДокОснование.Итог("Сумма")+ДокОснование.Итог("НДС");
		КонецЕсли;
		
		Если 	(ДокВид="ПриходнаяНакладная") ИЛИ
	 			(ДокВид="ПриходнаяРеализатора") Тогда
			Сумма=ДокОснование.Итог("Сумма")+ДокОснование.Итог("НДС");
			Валюта=ДокОснование.Валюта;
			ВидОплаты=Перечисление.ВидыОплаты.Возврат;
		ИначеЕсли 	(ДокВид="РегистрацияСчета_фактуры") Тогда
			Сумма=ДокОснование.Сумма;
			Валюта=Рубли;
		КонецЕсли;  
		
		Если ДокВид="ПриходнаяНакладная" Тогда 
	    	СуммаНДС=ДокОснование.Итог("НДС");
		    СуммаНП=ДокОснование.Итог("СуммаНП"); 
		КонецЕсли;
	Иначе
		Предупреждение("Расходный кассовый ордер нельзя вводить на основании выбранного вида документа!!!");
		СтатусВозврата(0);
	КонецЕсли;
	Курс = курсДлявалюты(Валюта, ДатадОк);

КонецПроцедуры
//---------------------------------------
Процедура ПриОткрытии()
	ПроверкаРазрешенияРедактирования(Контекст);
	УстановкаРеквизитаТип(Контекст);
	Тип.ДобавитьЗначение("Упр.");
	Тип.ДобавитьЗначение("Общ.");
	Тип.ДобавитьЗначение("Фин.");
	Тип.ТекущаяСтрока(ТипУчета+1);
	Если Форма.ТолькоПросмотр()=1 Тогда
	    Форма.КнФирма.Доступность(0);
	    Форма.ОК.Доступность(0);
	    Форма.КнопкаПоУмолчанию("Закрыть");
	Иначе
	    Форма.КнопкаПоУмолчанию("ОК");
	КонецЕсли;                     
	
    ДокументОснование.ВидыДляВыбора("Счет,РасходнаяНакладная,ЗаказОтПокупателя");
                       
	Доступ();
КонецПроцедуры   
//_____________________________________________________________________________ 
Процедура УстДокумент()
	ПоДокументу="паспорту серии "+СокрП(Клиент.СерияПаспорта)+" №"+СокрП(Клиент.НомерПаспорта)+", выданному "+СокрП(Клиент.КемВыданПаспорт)+" "+СокрЛП(Формат(Клиент.ДатаВыдачиПаспорта,"Д ДДММММГГГГ"))
КонецПроцедуры
//_____________________________________________________________________________ 
Процедура ПриВыбореКлиента()
	ПоДокументу = "";
	КлГруппа=?(Клиент.КлГруппа.Выбран()=1,Клиент.КлГруппа,Клиент);
	КлиентНаим = Клиент.ПолноеНаименование;    
	Если Клиент.ВидКонтрагента = Перечисление.ВидыКонтрагентов.ЧастноеЛицо Тогда
		УстДокумент();    	    
	КонецЕсли;  
		Если  Клиент.ВидКонтрагента=Перечисление.ВидыКонтрагентов.Сотрудник Тогда 
		ТекстС="Выбран сотрудник фирмы";
	Иначе
		ТекстС="";
	КонецЕсли;
КонецПроцедуры
//_____________________________________________________________________________
//Процедура Печать()                       
//	Фирма.ИспользоватьДату(ДатаДок);
//	Таб=СоздатьОбъект("Таблица");        
//	Таб.ИсходнаяТаблица("Таблица"); 
//	Курс=Валюта.Курс.Получить(ДатаДок);
//	Если (ФлагПечатьВВалюте = 0) И (Валюта.Выбран() = 1) Тогда
//		СуммаРКО			= Окр(Пересчет(Сумма,Валюта,Курс,Рубли,ДатаДок), 2, 1);
//		СуммаРКОПрописью	= СуммаПрописьюРКО(СуммаРКО, Рубли);
//		СуммаРКО            = ФРМ(СуммаРКО,Рубли,1); 
//	Иначе
//		СуммаРКО			= ФРМ(Сумма,Валюта,1); 
//		СуммаРКОПрописью=СуммаПрописьюРКО(Сумма,Валюта);
//	КонецЕсли; 
//	
//	Таб.Вывести();
//	Таб.Опции(0,0,0,0,"ОпцииПечатиРасходногоОрдера");
//	Таб.ТолькоПросмотр(1);
//	Таб.Показать("Печать расходного кассового ордера","");
//КонецПроцедуры 
Процедура Печать()
	Таб=СоздатьОбъект("Таблица");
	Таб.Вывести();
	Таб.Опции(0,0,0,0,ПарСтрДок);
	Таб.Защита(Константа.ФлагЗащитыТаблиц);
	Таб.ТолькоПросмотр(1);
	Таб.Показать("Расходный кассовый ордер","");
КонецПроцедуры

//_____________________________________________________________________________ 
//Начало текста, вставленного Инсталлятором МОД
Процедура ПриЗаписи()
	//Внимание: данная процедура при обновлении Менеджера будет перезаписана заново
	//без сохранения текущего кода !!!
	//Рекомендуем собственные алгоритмы записывать в старую процедуру с префиксом стар_
//	ПриИзмененииОбъекта(Контекст, ТекущийДокумент(), ДатаДок);
	Если семМожноЗаписать( Контекст ) = 0 Тогда Возврат; КонецЕсли;
КонецПроцедуры
//Конец текста, вставленного Инсталлятором МОД
ТекстС="";
