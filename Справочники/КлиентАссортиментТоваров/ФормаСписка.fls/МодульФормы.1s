//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Функция ФорматВывода( парам )
	Если парам = "КодТовара" Тогда
		Возврат ?( Товар.Выбран() = 1, Товар.Код, "" );
	ИначеЕсли парам = "Пиктограмма" Тогда
		Если ПустоеЗначение(Товар) = 1 Тогда Возврат 0; КонецЕсли;
		Возврат ?(Товар.ЭтоГруппа() = 1,4,1);
	КонецЕсли;
КонецФункции
                      
Процедура ПриРедактированииНовойСтроки()
	КатегорияЦены=Владелец.КатегорияЦены;
КонецПроцедуры


//Начало текста, вставленного Инсталлятором МОД
Процедура ПриПереносеЭлементаВДругуюГруппу(Спр, Группа)
	//Внимание: данная процедура при обновлении Менеджера будет перезаписана заново
	//без сохранения текущего кода !!!
	//Рекомендуем собственные алгоритмы записывать в старую процедуру с префиксом стар_
	ПриИзмененииОбъекта(Контекст, ТекущийЭлемент(), РабочаяДата());
КонецПроцедуры
//Конец текста, вставленного Инсталлятором МОД
//Начало текста, вставленного Инсталлятором МОД
Процедура ПриЗаписи()
	//Внимание: данная процедура при обновлении Менеджера будет перезаписана заново
	//без сохранения текущего кода !!!
	//Рекомендуем собственные алгоритмы записывать в старую процедуру с префиксом стар_
	ПриИзмененииОбъекта(Контекст, ТекущийЭлемент(), РабочаяДата());

КонецПроцедуры
//Конец текста, вставленного Инсталлятором МОД


//**************************************
Процедура НайтиКод()
	
	ИерархическийСписок(1,1);
	
	Запрос=СоздатьОбъект("ODBCRecordSet");
	ТекстЗапроса="SELECT СпрКС.ID [Элемент $Справочник.КлиентАссортиментТоваров]
	|			  FROM $Справочник.КлиентАссортиментТоваров СпрКС 
	|			  INNER JOIN $Справочник.Номенклатура СпрН ON СпрН.ID=$СпрКС.ТовГруппа AND СпрН.CODE=:КодПоиска
	|			  WHERE СпрКС.PARENTEXT=:Владелец
	|";
	Запрос.УстановитьТекстовыйПараметр("КодПоиска",сокрЛП(ПоискКод));
	Запрос.УстановитьТекстовыйПараметр("Владелец",Владелец);
	
	Элем=Запрос.ВыполнитьСкалярный(ТекстЗапроса);
	
	Если ПустоеЗначение(Элем)=1 Тогда
		Предупреждение("Код товара не найден в списке!");
		Активизировать("ПоискКод");
		Возврат;
	КонецЕсли;
	
	АктивизироватьОбъект(Элем);
	
КонецПроцедуры

//======================================================================
Процедура Импорт()
	
	Если Вопрос("Все элементы будут удалены. Продоолжить?","Да+Нет")="Да" Тогда
	Иначе
		Возврат;
	КонецЕсли;
	Запрос = СоздатьОбъект("ODBCRecordSet");
	ТекстЗапроса="SELECT DISTiNCT A.CODE, СпрТ.ID [Ссылка $Справочник.Номенклатура]
	|			  FROM trade1.test.dbo.GlobalTextAssortment A
	|			  LEFT JOIN $Справочник.Номенклатура СпрТ ON СпрТ.CODE = A.CODE AND СпрТ.ISFOLDER = 1";
	
	СпрК = СоздатьОбъект("Справочник.Контрагенты");
	Если СпрК.Выбрать("Выберите владельца","ФормаСписка")=0 Тогда
		Возврат;
	КонецЕсли;

	Владелец_ = СпрК.ТекущийЭлемент();
	СпрА=СоздатьОбъект("Справочник.КлиентАссортиментТоваров");
	СпрА.ИспользоватьВладельца(Владелец_);
	СпрА.ВыбратьЭлементы();
	Пока СпрА.ПолучитьЭлемент() = 1 Цикл
		СпрА.Удалить(1);
	КонецЦикла;
	
	
	СпрТ=СоздатьОбъект("Справочник.Номенклатура");
	табл=Запрос.ВыполнитьИнструкцию(ТекстЗапроса);
	Если табл.ВыбратьСтроку()=1 Тогда
	Иначе
		Возврат;
	КонецЕсли;
	
	табл.ВыбратьСтроки();
	Пока табл.ПолучитьСтроку()=1 Цикл
		Если ПустоеЗначение(табл.Ссылка)=0 Тогда
			СпрА.ИспользоватьВладельца(Владелец_);
			СпрА.Новый();
			СпрА.Наименование 	= табл.Ссылка.Наименование;
			СпрА.Товар 			= табл.Ссылка;
			СпрА.КатегорияЦены 	= Владелец.КатегорияЦены;
			ОбъектЗаписать(СпрА);
		Иначе
			Сообщить("Не найден товар по коду "+табл.CODE);
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры // Импорт
                      
Форма.Товар.ВыборГруппы(1);
Владелец_ = Владелец;

