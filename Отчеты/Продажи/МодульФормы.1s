//-------------------------------
Перем ТекущТовар;
Перем ПустаяФирма;
Перем ПереченьКодовОпераций; 
Перем ТипУч;  
Перем Заг1;
//------------------------------- 
Процедура ПриОткрытии()
	Если Константа.ПартииНаСкладах<>Перечисление.Булево.Да Тогда
		Форма.ВыбСклад.Видимость(0);
		Форма.ТекстСкл.Видимость(0);
	КонецЕсли;  
	ВыбФирма=Константа.ОсновнаяФирма; 
	Форма.ВыбФирма.Видимость(0); 
	Форма.ХВыбФ.Видимость(0);
	Тип.ДобавитьЗначение(1,"Упр.");
	Тип.ДобавитьЗначение(2,"Фин.");  
	//ТипУч="Упр";
	Заг1="(упр.учет)";
	ВклНДС=1;
	
	глПриОткрытии(Контекст,"Продажи");
	
КонецПроцедуры  
//-------------------------------    

Процедура СменаТипа()               
	Если Тип.ТекущаяСтрока()=1 Тогда
		ТипУч="Упр";
		Заг1="(упр.учет)"; 
		Форма.ВалютаОтчета.Доступность(1);
		Форма.ВыбВалюта.Доступность(1);
		Форма.ВалХ.Доступность(1); 
		Форма.ВыбФирма.Видимость(0); 
		Форма.ХВыбФ.Видимость(0);
		Тип.ТекущаяСтрока(1);
	Иначе
		ТипУч="Фин";      
		Заг1="(фин.учет)";
		ВыбВалюта=Константа.БазоваяВалюта;
		Форма.ВалютаОтчета.Доступность(0);
		Форма.ВыбВалюта.Доступность(0);
		Форма.ВалХ.Доступность(0);
		Форма.ВыбФирма.Видимость(1); 
		Форма.ХВыбФ.Видимость(1);
		
	КонецЕсли;
КонецПроцедуры  
//-------------------------------   	
Процедура Продажа(Режим)
	начЛог = семЗаписатьЛогНач( "Отчет", "Отчет о продажах", "Обработка", Шаблон("Формирование отчета ([Режим])") );
	МарОтч="МарочныйОтчет";
	РасхНаклНал="РасходнаяНакладнаяНал";
	РасхНакл="РасходнаяНакладная";
	ОтчетРеализ="ОтчетРеализатора";  
	ИнвРеализ="ИнвентаризацияРеализатора";  
	// Здесь формируется отчет, который использует регистры, критичные к 
	// последовательности проведения документов
	// поэтому сравним установленные даты периода формируемого отчета с ГП 
	Заг="";
	// Сделаем это при помощи механизма Запросов
	ПустаяФирма=глФирма; 
	Если ТипУч="Упр"Тогда
		ПроверкаАктуальностиОтчета(ДатаНачала,ДатаКонец,"Упр");
	Иначе
		ПроверкаАктуальностиОтчета(ДатаНачала,ДатаКонец,"Фин",ВыбФирма);  
		Заг=Заг+" По фирме: " + СокрП(ВыбФирма.Наименование)+".";
	КонецЕсли;	
	Если ДатаКонец>=ПолучитьДатуТА() Тогда
		ДатаКон=0; 
		ДатаКонец=ПолучитьДатуТА(); 
	Иначе
		ДатаКон=ДатаКонец; 
	КонецЕсли;                        
	
	ПереченьКодовОпераций=СоздатьОбъект("СписокЗначений");
	
//	ПереченьКодовОпераций=ПродажаБлюда+ПродажаТовара+ПроданоРеализатором+ПродажаПринятогоТовара;
	ПереченьКодовОпераций.ДобавитьЗначение(ПродажаБлюда);
	ПереченьКодовОпераций.ДобавитьЗначение(ПродажаТовара);
	ПереченьКодовОпераций.ДобавитьЗначение(ПроданоРеализатором);
	ПереченьКодовОпераций.ДобавитьЗначение(ПродажаПринятогоТовара);
	
	Запрос=СоздатьОбъект("Запрос");
	
	ТекстЗапроса="
	|ПЕРИОД С ДатаНачала По ДатаКонец;
	|Товар=Регистр.ПартииТоваров.Товар;
	|Фирма=Регистр.ПартииТоваров.Фирма;
	|ПрихДокумент=Регистр.ПартииТоваров.ПрихДокумент;
	|Докум=Регистр.ПартииТоваров.ТекущийДокумент;
	|Клиент=Регистр.ПартииТоваров.ТекущийДокумент.РасходнаяНакладная.Клиент,Регистр.ПартииТоваров.ТекущийДокумент.ОтчетРеализатора.Клиент,Регистр.ПартииТоваров.ТекущийДокумент.ИнвентаризацияРеализатора.Клиент,Регистр.ПартииТоваров.ТекущийДокумент.МарочныйОтчет.Клиент;
	|ОстатокТовара=Регистр.ПартииТоваров.ОстатокТовара; 
	|Стоимость=Регистр.ПартииТоваров.Стоимость;
	|НДС=Регистр.ПартииТоваров.НДС;
	|Оборот=Регистр.ПартииТоваров.Оборот;
	|КодОперации=Регистр.ПартииТоваров.КодОперации;
	|ФлагУчета=Регистр.ПартииТоваров.ФлагУчета;";
	Если ВыбСклад.Выбран()<>0 Тогда         
		ТекстЗапроса=ТекстЗапроса+"
		|Склад=Регистр.ПартииТоваров.Склад;";
	КонецЕсли;  
	
	Если (ПоТоварам=1)  Тогда
		ТекстЗапроса=ТекстЗапроса+"
		|Группировка Товар Без групп;
		|Группировка Клиент Без групп;";
	Иначе
		ТекстЗапроса=ТекстЗапроса+"
		|Группировка Клиент Без групп;
		|Группировка Товар Без групп;";
	КонецЕсли;
	Если (Режим="Подробный")  Тогда
		ТекстЗапроса=ТекстЗапроса+"
		|Группировка Документ;";
	КонецЕсли;
	ТекстЗапроса=ТекстЗапроса+"
	|Функция РасхОстатокТовара=Расход(ОстатокТовара); 
	|Функция РасхСебест=Расход(Стоимость); 
	|Функция НДССебест=Расход(НДС);
	|Функция СуммаРозн=Расход(Оборот);
	|Функция ОборотТовара=Сумма(Оборот);
	|Условие (КодОперации в ПереченьКодовОпераций);
	|"; 
	Если ТипУч="Упр" Тогда         
		ТекстЗапроса=ТекстЗапроса+" 
		|Условие (Фирма=ПустаяФирма);";
	Иначе  
		ТекстЗапроса=ТекстЗапроса+" 
		|Условие (Фирма=ВыбФирма);";
	КонецЕсли;            
	                 
	
	Если ВыбСклад.Выбран() = 0 Тогда         
		Заг=Заг+"   По всем складам"+". ";
	ИначеЕсли ВыбСклад.ЭтоГруппа()=1 Тогда
		ТекстЗапроса=ТекстЗапроса+"Условие (Склад в ВыбСклад);"; 
		Заг=Заг+"   По группе складов: " + СокрП(ВыбСклад.Наименование)+". ";
	Иначе
		ТекстЗапроса=ТекстЗапроса+"Условие (Склад=ВыбСклад);"; 
		Заг=Заг+"   По складу: " + СокрП(ВыбСклад.Наименование)+". ";
	КонецЕсли;
	
	Если ВыбТовар.Выбран()=0 Тогда
		Заг=Заг+"По всем товарам"+". ";
	ИначеЕсли ВыбТовар.ЭтоГруппа()=1 Тогда
		ТекстЗапроса=ТекстЗапроса+"Условие(Товар в ВыбТовар);";
		Заг=Заг+"По товарам группы: "+СокрП(ВыбТовар.Наименование)+". ";
	Иначе
		ТекстЗапроса=ТекстЗапроса+"Условие(Товар=ВыбТовар);";
		Заг=Заг+"По товару: " + СокрП(ВыбТовар.Наименование)+". ";
	КонецЕсли;   
	
	Если ВыбКлиент.Выбран()=0 Тогда
		Заг=Заг+"По всем клиентам"+". ";
	ИначеЕсли ВыбКлиент.ЭтоГруппа()=1 Тогда
		ТекстЗапроса=ТекстЗапроса+"Условие(Клиент в ВыбКлиент);";
		Заг=Заг+"По клиентам группы: "+СокрП(ВыбКлиент.Наименование)+". ";
	Иначе
		ТекстЗапроса=ТекстЗапроса+"Условие(Клиент=ВыбКлиент);";
		Заг=Заг+"По клиенту: " + СокрП(ВыбКлиент.Наименование)+". ";
	КонецЕсли;     
	
	Если ВидПродаж = 2 Тогда   		
		ТекстЗапроса=ТекстЗапроса+"  
//		|Условие ((ФлагУчета=13) ИЛИ (ФлагУчета=13));"; 
		|Условие ((Докум.Вид()=МарОтч) ИЛИ (Докум.Вид()=РасхНаклНал));"; 
		ВыбКлиент=0;
	КонецЕсли;   
	
	Если ВидПродаж = 3 Тогда   		
		ТекстЗапроса=ТекстЗапроса+"  
		|Условие (Докум.Вид()=РасхНакл);"; 
	КонецЕсли;  
	
	Если ВидПродаж = 4 Тогда   		
		ТекстЗапроса=ТекстЗапроса+"  
		|Условие ((Докум.Вид()=ОтчетРеализ) ИЛИ (Докум.Вид()=ИнвРеализ));"; 
	КонецЕсли; 
	
	Если ТипыТоваров = 2 Тогда   		
		ТекстЗапроса=ТекстЗапроса+"  
		|Условие (Товар.ВидТовара=Перечисление.ВидыТоваров.Блюдо);"; 
	КонецЕсли;   
	Если ТипыТоваров = 3 Тогда   		
		ТекстЗапроса=ТекстЗапроса+"  
		|Условие (Товар.ВидТовара=Перечисление.ВидыТоваров.Ингредиент);"; 
	КонецЕсли;  
	Если ТипыТоваров = 4 Тогда   		
		ТекстЗапроса=ТекстЗапроса+"  
		|Условие (Товар.ВидТовара=Перечисление.ВидыТоваров.Товар);"; 
	КонецЕсли;

	Флаг=Запрос.Выполнить(ТекстЗапроса);
	Если Флаг=0 тогда
		Предупреждение("Запрос по Партиям не выполнился!!!");
		Возврат;
	КонецЕсли;
	//  Создание Таблицы для выходного отчета
	Таб=СоздатьОбъект("Таблица");
	ВалютаОтчета=?(ВыбВалюта.Выбран()=0,Константа.ВалютаВзаиморасчетов,ВыбВалюта);
	
	// теперь в запросе собраны все Документы по партиям 
	ЧислоСтрок=0;
	Таб.ВывестиСекцию("Отчет");
	Оживить(4);
	ИтогоОборот=0; 
	ИтогоПСБезНДС=0;
	ИтогоПСсНДС=0;
	ИтогоНДС=0;
	Если (ПоТоварам=1)  Тогда
		Таб.ВывестиСекцию("ШапкаТов");
		Пока Запрос.Группировка("Товар")=1 Цикл
			ТекТовар=Запрос.Товар;
			Если ТекТовар.Выбран()=0 Тогда
				Продолжить;
			КонецЕсли;
			ВУ=ТекТовар.ВалютаУчета;  
			Если ТипУч="Фин" Тогда
				ВП=Константа.БазоваяВалюта;
				ВУ=ВП;
			Иначе
				ВУ=ТекТовар.ВалютаУчета;
				ВП=?(ВыбВалюта.Выбран()=0,ВУ,ВыбВалюта);
			КонецЕсли;	
			ПечТовар=СокрП(ТекТовар.Наименование);
			// Расчет сумм
			ПромСумма=Запрос.СуммаРозн;
			ПечЦена=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец)/Запрос.РасхОстатокТовара,ВП,1);
			ПечСумма=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
			ПечРасходОстатокТовара=Запрос.РасхОстатокТовара;
			ПромСеб1=Запрос.РасхСебест;
			ПечСебестБезНДС=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
			ПромСеб2=Запрос.РасхСебест;
			ПечСебест=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);  
			ПечНДС=ФРМ(Пересчет(Запрос.НДССебест,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
			ПромСуммаЭф=ПромСумма-ПромСеб1;
			ПечСуммаЭф=ФРМ(Пересчет(ПромСуммаЭф,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1); 
			Если ПромСеб1<>0 Тогда
				ПечПроцентЭф=Окр((ПромСуммаЭф/ПромСеб1)*100,2);
			Иначе  
				ПечПроцентЭф=0;
			КонецЕсли;	
			// --------
			Таб.ВывестиСекцию("Товар");
			Оживить(1);
			ИтогоОборот=ИтогоОборот+Пересчет(Запрос.ОборотТовара,ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
			ИтогоПСБезНДС=ИтогоПСБезНДС+Пересчет(Запрос.РасхСебест,ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
			ИтогоПСсНДС=ИтогоПСсНДС+Пересчет((Запрос.РасхСебест),ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
			ИтогоНДС=ИтогоНДС+Пересчет(Запрос.НДССебест,ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
			Пока Запрос.Группировка("Клиент") = 1 Цикл
				ПечКлиент=СокрП(Запрос.Клиент.Наименование);
				// Расчет сумм
				ПромСумма=Запрос.СуммаРозн;
				ПечЦена=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец)/Запрос.РасхОстатокТовара,ВП,1);
				ПечСумма=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПечРасходОстатокТовара=Запрос.РасхОстатокТовара;
				ПромСеб1=Запрос.РасхСебест;
				ПечСебестБезНДС=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПромСеб2=Запрос.РасхСебест;
				ПечСебест=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПечНДС=ФРМ(Пересчет(Запрос.НДССебест,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПромСуммаЭф=ПромСумма-ПромСеб1;
				ПечСуммаЭф=ФРМ(Пересчет(ПромСуммаЭф,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				Если ПромСеб1<>0 Тогда
					ПечПроцентЭф=Окр((ПромСуммаЭф/ПромСеб1)*100,2);
				Иначе  
					ПечПроцентЭф=0;
				КонецЕсли;
				// --------
			
				Если (Режим="Подробный")  Тогда 
					Если СокрЛП(Запрос.Клиент)<>""  Тогда
						Таб.ВывестиСекцию("РасходКлиент");
					КонецЕсли;	
					Оживить(1);
					Пока Запрос.Группировка("Документ") = 1 Цикл 
						Док=Запрос.Документ;
						Если Док.Выбран()=0 Тогда // пропускаем непонятные документы
							Продолжить;
						КонецЕсли;
						ПечНомерДок=""+СокрП(Док)+" от "+Док.ДатаДок;
						// Расчет сумм
						ПромСумма=Запрос.СуммаРозн;
						ПечЦена=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец)/Запрос.РасхОстатокТовара,ВП,1);
						ПечСумма=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПечРасходОстатокТовара=Запрос.РасхОстатокТовара;
						ПромСеб1=Запрос.РасхСебест;
						ПечСебестБезНДС=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПромСеб2=Запрос.РасхСебест;
						ПечСебест=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПечНДС=ФРМ(Пересчет(Запрос.НДССебест,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПромСуммаЭф=ПромСумма-ПромСеб1;
						ПечСуммаЭф=ФРМ(Пересчет(ПромСуммаЭф,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1); 
						Если ПромСеб1<>0 Тогда
							ПечПроцентЭф=Окр((ПромСуммаЭф/ПромСеб1)*100,2);
						Иначе  
							ПечПроцентЭф=0;
						КонецЕсли;
						
						// --------
						
						Таб.ВывестиСекцию("Документ");
						Оживить(1);
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
		КонецЦикла;
	Иначе
		Таб.ВывестиСекцию("ШапкаКлн");
		Пока Запрос.Группировка("Клиент")=1 Цикл
			ПечКлиент=СокрП(Запрос.Клиент.Наименование);
			КлИтогоОборот=0;  
			КлИтогоПСБезНДС=0;
			КлИтогоПСсНДС=0;
			КлИтогоНДС=0;
			Таб.ВывестиСекцию("Клиент");
			Оживить(1);
			Пока Запрос.Группировка("Товар")=1 Цикл
				ТекТовар=Запрос.Товар;
				Если ТекТовар.Выбран()=0 Тогда
					Продолжить;
				КонецЕсли;
				Если ТипУч="Фин" Тогда
					ВП=Константа.БазоваяВалюта;
					ВУ=ВП;
				Иначе
					ВУ=ТекТовар.ВалютаУчета;
					ВП=?(ВыбВалюта.Выбран()=0,ВУ,ВыбВалюта);
				КонецЕсли;	
				ПечТовар=СокрП(ТекТовар.Наименование);
				// Расчет сумм
				ПромСумма=Запрос.СуммаРозн;
				ПечЦена=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец)/Запрос.РасхОстатокТовара,ВП,1);
				ПечСумма=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПечРасходОстатокТовара=Запрос.РасхОстатокТовара;
				ПромСеб1=Запрос.РасхСебест;
				ПечСебестБезНДС=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПромСеб2=Запрос.РасхСебест;
				ПечСебест=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПечНДС=ФРМ(Пересчет(Запрос.НДССебест,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
				ПромСуммаЭф=ПромСумма-ПромСеб1;
				ПечСуммаЭф=ФРМ(Пересчет(ПромСуммаЭф,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1); 
				Если ПромСеб1<>0 Тогда
					ПечПроцентЭф=Окр((ПромСуммаЭф/ПромСеб1)*100,2);
				Иначе  
					ПечПроцентЭф=0;
				КонецЕсли;
				// --------
				
				Таб.ВывестиСекцию("РасходТовар");
				Оживить(1);
				КлИтогоОборот=КлИтогоОборот+Пересчет(Запрос.ОборотТовара,ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
				КлИтогоПСБезНДС=КлИтогоПСБезНДС+Пересчет(Запрос.РасхСебест,ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
				КлИтогоПСсНДС=КлИтогоПСсНДС+Пересчет((Запрос.РасхСебест+Запрос.НДССебест),ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
				КлИтогоНДС=КлИтогоНДС+Пересчет(Запрос.НДССебест,ВУ,ДатаКонец,ВалютаОтчета,ДатаКонец);
				ПечКлИтогоОборот=ФРМ(КлИтогоОборот,ВалютаОтчета,1);
				ПечКлИтогоПСБезНДС=ФРМ(КлИтогоПСБезНДС,ВалютаОтчета,1);
				ПечКлИтогоПСсНДС=ФРМ(КлИтогоПСсНДС,ВалютаОтчета,1);  
				ПечКлИтогоНДС=ФРМ(КлИтогоНДС,ВалютаОтчета,1);  
				КлИтогоСуммаЭф=КлИтогоОборот-КлИтогоПСсНДС;          
				ПечКлИтогоСуммаЭф=ФРМ(КлИтогоСуммаЭф,ВалютаОтчета,1);  
				КлИтогоПроцентЭф=Окр((КлИтогоСуммаЭф/КлИтогоПСсНДС)*100,2);
				Если (Режим="Подробный")  Тогда
					Пока Запрос.Группировка("Документ") = 1 Цикл 
						Док=Запрос.Документ;
						Если Док.Выбран()=0 Тогда // пропускаем непонятные документы
							Продолжить;
						КонецЕсли;
						ПечНомерДок=""+СокрП(Док)+" от "+Док.ДатаДок;   
						// Расчет сумм
						ПромСумма=Запрос.СуммаРозн;
						ПечЦена=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец)/Запрос.РасхОстатокТовара,ВП,1);
						ПечСумма=ФРМ(Пересчет(ПромСумма,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПечРасходОстатокТовара=Запрос.РасхОстатокТовара;
						ПромСеб1=Запрос.РасхСебест;
						ПечСебестБезНДС=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПромСеб2=Запрос.РасхСебест;
						ПечСебест=ФРМ(Пересчет(ПромСеб1,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПечНДС=ФРМ(Пересчет(Запрос.НДССебест,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1);
						ПромСуммаЭф=ПромСумма-ПромСеб1;
						ПечСуммаЭф=ФРМ(Пересчет(ПромСуммаЭф,ВУ,ДатаКонец,ВП,ДатаКонец),ВП,1); 
						Если ПромСеб1<>0 Тогда
							ПечПроцентЭф=Окр((ПромСуммаЭф/ПромСеб1)*100,2);
						Иначе  
							ПечПроцентЭф=0;
						КонецЕсли;
						
						// --------
						
						Таб.ВывестиСекцию("Документ");
						Оживить(1);
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
			ИтогоОборот=ИтогоОборот+КлИтогоОборот;
			ИтогоПСБезНДС=ИтогоПСБезНДС+КлИтогоПСБезНДС;
			ИтогоПСсНДС=ИтогоПСсНДС+КлИтогоПСсНДС; 
			ИтогоНДС=ИтогоНДС+КлИтогоНДС;
		    Таб.ВывестиСекцию("ИтогоПоКлиенту");
			Оживить(1);	
			
		КонецЦикла;
		
	КонецЕсли;
	ИтогоСуммаЭф=ИтогоОборот-ИтогоПСсНДС;  
	Если ИтогоПСсНДС=0 Тогда
		ИтогоПроцентЭф=0;
	Иначе	
		ИтогоПроцентЭф=Окр((ИтогоСуммаЭф/ИтогоПСсНДС)*100,2);
	КонецЕсли;
	ПечИтогоОборот=ФРМ(ИтогоОборот,ВалютаОтчета,1);
	ИтогоПСБезНДС=ФРМ(ИтогоПСБезНДС,ВалютаОтчета,1); 
	ИтогоПСсНДС=ФРМ(ИтогоПСсНДС,ВалютаОтчета,1); 
	ИтогоСуммаЭф=ФРМ(ИтогоСуммаЭф,ВалютаОтчета,1);
	ИтогоНДС=ФРМ(ИтогоНДС,ВалютаОтчета,1); 
	Таб.ВывестиСекцию("Итого");
	Оживить(1);
	//Вызов выходного отчета в окно просмотра и редактирования.
	Таб.ТолькоПросмотр(1);
	Таб.Опции(0,0,5,0);  
	Таб.ПараметрыСтраницы(2,,,,,,,,,,,);
	Таб.Показать("Отчет по продажам товаров","");
	семЗаписатьЛогКон( начЛог );	
КонецПроцедуры

//-------------------------------
Процедура ПриВыбореПоТоварам()
	Если ПоТоварам=1 Тогда
		ПоКлиентам=0;
	Иначе
		ПоКлиентам=1;
	КонецЕсли;
КонецПроцедуры
//-------------------------------
Процедура ПриВыбореПоКлиентам()
	Если ПоКлиентам=1 Тогда
		ПоТоварам=0;
	Иначе
		ПоТоварам=1;
	КонецЕсли;
КонецПроцедуры
//------------------------------- 
Процедура ВыборКл()   
	   	Если ВидПродаж = 2 Тогда   		
			Форма.ВыбКлиент.Доступность(0);
			ВыбКлиент=0; 
		Иначе
			Форма.ВыбКлиент.Доступность(1);
		КонецЕсли;   
	   
КонецПроцедуры
//------------------------------- 

ДатаКонец=ПолучитьДатуТА();
ДатаНачала=Константа.ОсновнаяДатаНачалаОтчета;
Если Число(ДатаНачала)=0 Тогда
	ДатаНачала='01.01.98';
Конецесли;  
ПоТоварам=1;
ВыбВалюта=Рубли;
ТипУч="Упр";