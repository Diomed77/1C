
Перем Сводная, КонструкторЗапросов, ВремПапка;
Перем гРФорма, гРасшФорма;
Перем Окна, ФормаРасш;
Перем ТекШирина, ТекВысота;
Перем КоммВерсия;
Перем ФайлКуба;

Перем ДатаОтчета1;
Перем ДатаСрока;


//-------------------------------
Процедура Очистить()
	ВыбТовар = 0; 
	ВыбКлиент = 0;               
КонецПроцедуры     
//-------------------------------

Процедура Сформировать()
	начЛог = семЗаписатьЛогНач( "Отчет", "Заказанные товары текущие", "Обработка", Шаблон("Формирование отчета") );
	//Рег1   = СоздатьОбъект("Регистр.ЗаказыПоставщикам");
	//Рег1.ВременныйРасчет();
    //РассчитатьРегистрыНа(ПолучитьДатуТА());
	//рег1.обратныйПорядок(1);		
    
	Запрос = СоздатьОбъект("Запрос");
	ТекстЗапроса =
	"//{{ЗАПРОС(ОтчетПоРезервам)
	|Товар = Регистр.ЗаказыПоставщикам.Товар;
	|Кол = Регистр.ЗаказыПоставщикам.Количество;
	|Клиент = Регистр.ЗаказыПоставщикам.Клиент;
	|Страна = Регистр.ЗаказыПоставщикам.Клиент.Страна;
	|ВидСтраны = Регистр.ЗаказыПоставщикам.Клиент.Страна.ВидСтраны;
	|Склад = Регистр.ЗаказыПоставщикам.Склад;
	|ДокЗаказ = Регистр.ЗаказыПоставщикам.ПоЗаказу;
	|СрокПоставки = Регистр.ЗаказыПоставщикам.СрокПоставки;
	|Группировка СрокПоставки;
	|Группировка ДокЗаказ;
	|Функция КонКол = КонОст(Кол);
	|Условие ((СрокПоставки >= ДатаНачала) И (СрокПоставки <= ДатаКонца));
	|"//}}ЗАПРОС
	;            
	
	заг="";
    Если ВыбТовар.Выбран() = 0 Тогда
		Заг =заг+ "По всем товарам";
	ИначеЕсли ВыбТовар.ЭтоГруппа() = 1 Тогда
		ТекстЗапроса = ТекстЗапроса + 
		"Условие (Товар в ВыбТовар);";
		Заг = "По товарам группы " + ВыбТовар.Наименование;
	Иначе
		ТекстЗапроса = ТекстЗапроса + "Условие (Товар = ВыбТовар);";
		Заг = "По товару " + ВыбТовар.Наименование;
	КонецЕсли;

	Если чВидСтраны=1 Тогда
		ТекстЗапроса = ТекстЗапроса + "Условие (ВидСтраны = Перечисление.ВидыСтран.СтранаРезидент);";
	ИначеЕсли 	чВидСтраны=2 Тогда
		ТекстЗапроса = ТекстЗапроса + "Условие (ВидСтраны <> Перечисление.ВидыСтран.СтранаРезидент);";
	Иначе
		
	КонецЕсли;
	
	Если Запрос.Выполнить(ТекстЗапроса) = 0 тогда
		Возврат;
	КонецЕсли;

 	ЧислоСтрок=0;
    ДокКлиент=СоздатьОбъект("Справочник.Контрагенты");
 	
	//  Создание Таблицы для выходного отчета

	Таб=СоздатьОбъект("Таблица");
	Таб.ВывестиСекцию("Отчет");
	                           
	Таб.ВывестиСекцию("Шапка");
	Оживить(4);
	Пока Запрос.Группировка("СрокПоставки") = 1 Цикл
		            
		Таб.ВывестиСекцию("СрокПоставки");
		
		Пока Запрос.Группировка("ДокЗаказ") = 1 Цикл
			
		    ост=запрос.КонКол;
			остквп=Формат(	Регистр.ТоварыВПути.СводныйОстаток(Запрос.Товар,,Запрос.ДокЗаказ,,"Количество"),"Ч011.3");
			Сумма=Запрос.ДокЗаказ.Итог("СуммаПодтв");
			Таб.ВывестиСекцию("Док");
			
		    
		КонецЦикла; //Товар
	КонецЦикла;	//Клиент
	//Вызов выходного отчета в окно просмотра и редактирования.
	Таб.Опции(0,0,6,0,ПарСтрОтчДлинн);
	Таб.Защита(Константа.ФлагЗащитыТаблиц);
	Таб.ПараметрыСтраницы(1,100,1,5,5,10,5,1);
	Таб.ТолькоПросмотр(1);
	Таб.Показать("Ожидаемые поставки","");
	семЗаписатьЛогКон( начЛог );	
КонецПроцедуры

//*******************************************
Процедура ПриЗакрытии()
	Если СтрДлина(ФайлКуба) > 0 Тогда
		XMLТаблицы = СтрЗаменить(Сводная.Объект.XMLData, ФайлКуба, "");
	КонецЕсли;
КонецПроцедуры


ДатаНачала = РабочаяДата();
ДатаКонца	= ДатаНачала;
СрокиПоставки = 1;
чВидСтраны=3;